version: '3.8'

# Docker Compose para perfil minimal - Solo infraestructura esencial
# Consumo estimado: ~400MB RAM

services:
  eureka-server:
    build: ./portal Backend/eureka-server
    container_name: eureka-server
    ports:
      - '8761:8761'
    networks:
      - tapalque-net
    deploy:
      resources:
        limits:
          memory: 128M
          cpus: '0.2'
    restart: unless-stopped

  msvc-gateway-server:
    build: ./portal Backend/msvc-gateway-server
    container_name: msvc-gateway-server
    ports:
      - '8090:8090'
    depends_on:
      - eureka-server
    networks:
      - tapalque-net
    deploy:
      resources:
        limits:
          memory: 192M
          cpus: '0.3'
    restart: unless-stopped

  msvc-jwt:
    build: ./portal Backend/msvc-jwt
    container_name: msvc-jwt
    depends_on:
      - eureka-server
    networks:
      - tapalque-net
    deploy:
      resources:
        limits:
          memory: 128M
          cpus: '0.2'
    restart: unless-stopped

  frontend:
    build: ./portal Frontend
    container_name: frontend
    ports:
      - '3000:80'
    depends_on:
      - msvc-gateway-server
    networks:
      - tapalque-net
    deploy:
      resources:
        limits:
          memory: 64M
          cpus: '0.1'
    restart: unless-stopped

networks:
  tapalque-net:
    driver: bridge