server:
  port: 8090

spring:
  application:
    name: msvc-gateway-server

  main:
    web-application-type: reactive

  cloud:
    gateway:
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins:
              - http://localhost:3000
            allowedMethods:
              - GET
              - POST
              - PUT
              - PATCH
              - DELETE
              - OPTIONS
            allowedHeaders:
              - Authorization
              - Content-Type
              - Accept
            exposedHeaders:
              - Authorization
            allowCredentials: true

      routes:
        # ========== RUTAS PÚBLICAS ==========
        - id: msvc-user-public
          uri: lb://msvc-user
          predicates:
            - Path=/api/user/public/register, /api/user/public/verify-email, /api/user/public/resend-verification
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}

        - id: msvc-jwt-login
          uri: lb://msvc-jwt
          predicates:
            - Path=/api/jwt/public/login, /api/jwt/public/refresh-token
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}

        # ========== RUTAS PÚBLICAS - LISTADOS (GET) ==========
        # Hostelería
        - id: msvc-hosteleria-list-public
          uri: lb://msvc-hosteleria
          predicates:
            - Path=/api/hospedajes
            - Method=GET
          filters:
            - RewritePath=/api/hospedajes, /hospedajes

        - id: msvc-hosteleria-detail-public
          uri: lb://msvc-hosteleria
          predicates:
            - Path=/api/hospedajes/{id}
            - Method=GET
          filters:
            - RewritePath=/api/hospedajes/(?<id>[0-9]+), /hospedajes/${id}

        # Hostelería - Archivos estáticos (imágenes)
        - id: msvc-hosteleria-uploads
          uri: lb://msvc-hosteleria
          predicates:
            - Path=/api/hospedaje/uploads/**
            - Method=GET
          filters:
            - RewritePath=/api/hospedaje/uploads/(?<file>.*), /uploads/${file}

          #disponibilidad y habitaciones de un hospedaje
        - id: msvc-hosteleria-disponibilidad-public
          uri: lb://msvc-hosteleria
          predicates:
            - Path=/api/hospedajes/{id:[0-9]+}/disponibilidad/**
            - Method=GET
          filters:
            - RewritePath=/api/hospedajes/(?<id>[0-9]+)/disponibilidad(?<rest>.*), /hospedajes/${id}/disponibilidad${rest}

        - id: msvc-hosteleria-habitaciones-list-public
          uri: lb://msvc-hosteleria
          predicates:
            - Path=/api/hospedajes/{id}/habitaciones
            - Method=GET
          filters:
            - RewritePath=/api/hospedajes/(?<id>[0-9]+)/habitaciones, /hospedajes/${id}/habitaciones

        # Gastronomía
        #findAll
        - id: msvc-gastronomia-list-public
          uri: lb://msvc-gastronomia
          predicates:
            - Path=/api/gastronomia/restaurants
            - Method=GET
          filters:
            - RewritePath=/api/gastronomia/restaurants, /restaurante/findAll
          #findById
        - id: msvc-gastronomia-detail-public
          uri: lb://msvc-gastronomia
          predicates:
            - Path=/api/gastronomia/restaurants/{id}
            - Method=GET
          filters:
            - RewritePath=/api/gastronomia/restaurants/(?<id>[0-9]+), /restaurante/findById/${id}

          # Ruta alternativa /api/gastronomia/{id}
        - id: msvc-gastronomia-by-id-public
          uri: lb://msvc-gastronomia
          predicates:
            - Path=/api/gastronomia/{id}
            - Method=GET
          filters:
            - RewritePath=/api/gastronomia/(?<id>[0-9]+), /restaurante/findById/${id}

        # Gastronomía - Archivos estáticos (imágenes)
        - id: msvc-gastronomia-uploads
          uri: lb://msvc-gastronomia
          predicates:
            - Path=/api/gastronomia/uploads/**
            - Method=GET
          filters:
            - RewritePath=/api/gastronomia/uploads/(?<file>.*), /uploads/${file}

          #menu de un restaurante
        - id: msvc-gastronomia-menu-public
          uri: lb://msvc-gastronomia
          predicates:
            - Path=/api/gastronomia/menu/restaurant/{id}
            - Method=GET
          filters:
            - RewritePath=/api/gastronomia/menu/restaurant/(?<id>[0-9]+), /gastronomia/menu/restaurant/${id}
          #filtros de un restaurante
        - id: msvc-gastronomia-menu-filter-public
          uri: lb://msvc-gastronomia
          predicates:
            - Path=/api/gastronomia/menu/restaurant/{id}/filter
            - Method=GET
          filters:
            - RewritePath=/api/gastronomia/menu/restaurant/(?<id>[0-9]+)/filter, /gastronomia/menu/restaurant/${id}/filter
          #categories
        - id: msvc-gastronomia-menu-categories-public
          uri: lb://msvc-gastronomia
          predicates:
            - Path=/api/gastronomia/menu/categories
            - Method=GET
          filters:
            - RewritePath=/api/gastronomia/menu/categories, /gastronomia/menu/categories
          #restrictions
        - id: msvc-gastronomia-menu-restrictions-public
          uri: lb://msvc-gastronomia
          predicates:
            - Path=/api/gastronomia/menu/restrictions
            - Method=GET
          filters:
            - RewritePath=/api/gastronomia/menu/restrictions, /gastronomia/menu/restrictions

        # Eventos
        - id: msvc-eventos-list-public
          uri: lb://msvc-eventos
          predicates:
            - Path=/api/evento
            - Method=GET
          filters:
            - RewritePath=/api/evento, /evento

        - id: msvc-eventos-detail-public
          uri: lb://msvc-eventos
          predicates:
            - Path=/api/evento/{id}
            - Method=GET
          filters:
            - RewritePath=/api/evento/(?<id>[0-9]+), /evento/${id}

        # Eventos - Archivos estáticos (imágenes)
        - id: msvc-eventos-uploads
          uri: lb://msvc-eventos
          predicates:
            - Path=/api/evento/uploads/**
            - Method=GET
          filters:
            - RewritePath=/api/evento/uploads/(?<file>.*), /uploads/${file}

        # Servicios
        - id: msvc-servicios-list-public
          uri: lb://msvc-servicios
          predicates:
            - Path=/api/servicio
            - Method=GET
          filters:
            - RewritePath=/api/servicio, /servicio

        - id: msvc-servicios-detail-public
          uri: lb://msvc-servicios
          predicates:
            - Path=/api/servicio/{id}
            - Method=GET
          filters:
            - RewritePath=/api/servicio/(?<id>[0-9]+), /servicio/${id}

        # Servicios - Archivos estáticos (imágenes)
        - id: msvc-servicios-uploads
          uri: lb://msvc-servicios
          predicates:
            - Path=/api/servicio/uploads/**
            - Method=GET
          filters:
            - RewritePath=/api/servicio/uploads/(?<file>.*), /uploads/${file}

        # Termas
        - id: msvc-termas-list-public
          uri: lb://msvc-termas
          predicates:
            - Path=/api/terma
            - Method=GET
          filters:
            - RewritePath=/api/terma, /terma

        - id: msvc-termas-detail-public
          uri: lb://msvc-termas
          predicates:
            - Path=/api/terma/{id}
            - Method=GET
          filters:
            - RewritePath=/api/terma/(?<id>[0-9]+), /terma/${id}

        # Termas - Archivos estáticos (imágenes)
        - id: msvc-termas-uploads
          uri: lb://msvc-termas
          predicates:
            - Path=/api/terma/uploads/**
            - Method=GET
          filters:
            - RewritePath=/api/terma/uploads/(?<file>.*), /uploads/${file}

        # Espacios Públicos
        - id: msvc-espacios-publicos-list-public
          uri: lb://msvc-espacios-publicos
          predicates:
            - Path=/api/espacio-publico,
            - Method=GET
          filters:
            - RewritePath=/api/espacio-publico, /espacio-publico

        - id: msvc-espacios-publicos-detail-public
          uri: lb://msvc-espacios-publicos
          predicates:
            - Path=/api/espacio-publico/{id}
            - Method=GET
          filters:
            - RewritePath=/api/espacio-publico/(?<id>[0-9]+), /espacio-publico/${id}

        # Espacios Públicos - Archivos estáticos (imágenes)
        - id: msvc-espacios-publicos-uploads
          uri: lb://msvc-espacios-publicos
          predicates:
            - Path=/api/espacio-publico/uploads/**
            - Method=GET
          filters:
            - RewritePath=/api/espacio-publico/uploads/(?<file>.*), /uploads/${file}

        # Comercio
        - id: msvc-comercio-list-public
          uri: lb://msvc-comercio
          predicates:
            - Path=/api/comercio/list
            - Method=GET
          filters:
            - RewritePath=/api/comercio/list, /comercio/list

        - id: msvc-comercio-detail-public
          uri: lb://msvc-comercio
          predicates:
            - Path=/api/comercio/{id}
            - Method=GET
          filters:
            - RewritePath=/api/comercio/(?<id>[0-9]+), /comercio/${id}

        # Comercio - Archivos estáticos (imágenes)
        - id: msvc-comercio-uploads
          uri: lb://msvc-comercio
          predicates:
            - Path=/api/comercio/uploads/**
            - Method=GET
          filters:
            - RewritePath=/api/comercio/uploads/(?<file>.*), /uploads/${file}

        # ========== RUTAS PRIVADAS (CON AUTENTICACIÓN) ==========
        - id: msvc-comercio-imagen
          uri: lb://msvc-comercio
          predicates:
            - Path=/api/comercio/imagen/**
            - Method=GET, DELETE, POST
          filters:
            - RewritePath=/api/comercio/imagen/(?<id>[0-9]+), /comercio/${id}/imagenes
            - JwtAuth

        - id: msvc-comercio-create
          uri: lb://msvc-comercio
          predicates:
            - Path=/api/comercio
            - Method=POST
          filters:
            - RewritePath=/api/comercio, /comercio
            - JwtAuth

        - id: msvc-comercio-update
          uri: lb://msvc-comercio
          predicates:
            - Path=/api/comercio/{id:[0-9]+}
            - Method=PUT,PATCH,DELETE
          filters:
            - RewritePath=/api/comercio/(?<id>[0-9]+), /comercio/${id}
            - JwtAuth

        - id: msvc-hospedaje-imagen
          uri: lb://msvc-hosteleria
          predicates:
            - Path=/api/hospedaje/imagen/{id}
            - Method=GET, DELETE, POST
          filters:
            - RewritePath=/api/hospedaje/imagen/(?<id>[0-9]+), /hospedaje/${id}/imagenes
            - JwtAuth

        - id: msvc-hosteleria-create
          uri: lb://msvc-hosteleria
          predicates:
            - Path=/api/hospedajes
            - Method=POST
          filters:
            - RewritePath=/api/hospedajes, /hospedajes
            - JwtAuth

        - id: msvc-hosteleria
          uri: lb://msvc-hosteleria
          predicates:
            - Path=/api/hospedajes/{id}
            - Method=PUT,DELETE
          filters:
            - RewritePath=/api/hospedajes/(?<id>[0-9]+), /hospedajes/${id}
            - JwtAuth

        - id: msvc-hosteleria-habitaciones
          uri: lb://msvc-hosteleria
          predicates:
            - Path=/api/habitaciones/{id}
            - Method=GET,PUT,DELETE,PATCH
          filters:
            - RewritePath=/api/(?<id>[0-9]+), /habitaciones/hospedajes/${id}
            - JwtAuth

        - id: msvc-hosteleria-habitaciones-disponibilidad-update
          uri: lb://msvc-hosteleria
          predicates:
            - Path=/api/habitaciones/{id}/disponibilidad
            - Method=PATCH
          filters:
            - RewritePath=/api/(?<id>[0-9]+), /habitaciones/${id}/disponibilidad
            - JwtAuth

        - id: msvc-gastronomia-imagen
          uri: lb://msvc-gastronomia
          predicates:
            - Path=/api/restaurante/{id:[0-9]+}/imagenes
            - Method=GET,POST,DELETE
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}
            - JwtAuth

        - id: msvc-gastronomia-create
          uri: lb://msvc-gastronomia
          predicates:
            - Path=/api/gastronomia
            - Method=POST
          filters:
            - RewritePath=/api/gastronomia, /restaurante/save
            - JwtAuth

        # PUT /api/gastronomia/{id} -> /restaurante/update/{id}
        - id: msvc-gastronomia-update
          uri: lb://msvc-gastronomia
          predicates:
            - Path=/api/gastronomia/{id}
            - Method=PUT
          filters:
            - RewritePath=/api/gastronomia/(?<id>[0-9]+), /restaurante/update/${id}
            - JwtAuth

        - id: msvc-gastronomia-delete
          uri: lb://msvc-gastronomia
          predicates:
            - Path=/api/gastronomia/delete/{id}
            - Method=DELETE
          filters:
            - RewritePath=/api/gastronomia/delete/(?<id>[0-9]+), /restaurante/delete/${id}
            - JwtAuth
        # MERCADO PAGO
        - id: msvc-mercado-pago
          uri: lb://msvc-mercado-pago
          predicates:
            - Path=/api/mercadopago/pagos/crear
            - Method=POST
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}
            - JwtAuth

        - id: msvc-mercado-pago
          uri: lb://msvc-mercado-pago
          predicates:
            - Path=/api/mercadopago/webhook
            - Method=POST
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}

        - id: msvc-mercado-pago
          uri: lb://msvc-mercado-pago
          predicates:
            - Path=/api/mercadopago/Oauth/callback
            - Method=GET
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}

        - id: msvc-mercado-pago
          uri: lb://msvc-mercado-pago
          predicates:
            - Path=/api/mercadopago/Oauth/init
            - Method=GET
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}

        - id: msvc-mercado-pago
          uri: lb://msvc-mercado-pago
          predicates:
            - Path=/api/mercado-pago/webhook
            - Method=POST
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}

        - id: msvc-mercado-pago
          uri: lb://msvc-mercado-pago
          predicates:
            - Path=/api/mercado-pago/pagos/crear
            - Method=POST
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}

        # PEDIDOS
        - id: msvc-pedidos
          uri: lb://msvc-pedidos
          predicates:
            - Path=/api/pedidos/orders/new
            - Method=POST
          filters:
            - RewritePath=/api/pedidos/(?<segment>.*), /${segment}
            - JwtAuth

        - id: msvc-pedidos
          uri: lb://msvc-pedidos
          predicates:
            - Path=/api/pedidos/orders/{id}
            - Method=GET
          filters:
            - RewritePath=/api/pedidos/(?<id>[0-9]+), /${id}
            - JwtAuth

        - id: msvc-pedidos
          uri: lb://msvc-pedidos
          predicates:
            - Path=/api/pedidos/orders/restaurant/{restaurantId}
            - Method=GET
          filters:
            - RewritePath=/api/pedidos/(?<segment>.*),  /${segment}
            - JwtAuth

        - id: msvc-pedidos
          uri: lb://msvc-pedidos
          predicates:
            - Path=/api/pedidos/orders/user/{userId}
            - Method=GET
          filters:
            - RewritePath=/api/pedidos/(?<segment>.*), /${segment}
            - JwtAuth

        - id: msvc-pedidos
          uri: lb://msvc-pedidos
          predicates:
            - Path=/api/pedidos/orders/{id:[0-9]+}
            - Method=PUT
          filters:
            - RewritePath=/api/pedidos/orders/(?<id>[0-9]+), /orders/${id}
            - JwtAuth

        - id: msvc-pedidos
          uri: lb://msvc-pedidos
          predicates:
            - Path=/api/pedidos/orders/{id:[0-9]+}
            - Method=DELETE
          filters:
            - RewritePath=/api/pedidos/orders/(?<id>[0-9]+), /orders/${id}
            - JwtAuth

        - id: msvc-pedidos
          uri: lb://msvc-pedidos
          predicates:
            - Path=/api/pedidos/orders/{id:[0-9]+}/estado
            - Method=PATCH
          filters:
            - RewritePath=/api/pedidos/orders/(?<id>[0-9]+), /orders/${id}/estado
            - JwtAuth

        # RESERVAS
        - id: msvc-reservas
          uri: lb://msvc-reservas
          predicates:
            - Path=/api/reservas/reservations/new
            - Method=POST
          filters:
            - RewritePath=/api/reservas/(?<segment>.*), /${segment}
            - JwtAuth

        - id: msvc-reservas
          uri: lb://msvc-reservas
          predicates:
            - Path=/api/reservas/reservations/by-id/{id:[0-9]+}
            - Method=GET
          filters:
            - RewritePath=/api/reservas/reservations/by-id/(?<id>[0-9]+), /reservations/by-id/${id}
            - JwtAuth

        - id: msvc-reservas
          uri: lb://msvc-reservas
          predicates:
            - Path=/api/reservas/reservations/update/{id:[0-9]+}
            - Method=PUT
          filters:
            - RewritePath=/api/reservas/reservations/update/(?<id>[0-9]+), /reservations/update/${id}
            - JwtAuth

        - id: msvc-reservas
          uri: lb://msvc-reservas
          predicates:
            - Path=/api/reservas/reservations/delete/{id:[0-9]+}
            - Method=DELETE
          filters:
            - RewritePath=/api/reservas/reservations/delete/(?<id>[0-9]+), /reservations/delete/${id}
            - JwtAuth

        - id: msvc-reservas
          uri: lb://msvc-reservas
          predicates:
            - Path=/api/reservas/reservations/by-hotel/{id:[0-9]+}
            - Method=GET
          filters:
            - RewritePath=/api/reservas/reservations/by-hotel/(?<id>[0-9]+), /reservations/by-hotel/${id}
            - JwtAuth

        - id: msvc-reservas
          uri: lb://msvc-reservas
          predicates:
            - Path=/api/reservas/reservations/by-customer/{id:[0-9]+}
            - Method=GET
          filters:
            - RewritePath=/api/reservas/reservations/by-customer/(?<id>[0-9]+), /reservations/by-customer/${id}
            - JwtAuth

          # EVENTOS
        - id: msvc-eventos-imagen
          uri: lb://msvc-eventos
          predicates:
            - Path=/api/evento/{id:[0-9]+}/imagenes
            - Method=POST,DELETE
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}
            - JwtAuth

        - id: msvc-eventos-create
          uri: lb://msvc-eventos
          predicates:
            - Path=/api/evento
            - Method=POST
          filters:
            - RewritePath=/api/evento, /evento
            - JwtAuth

        - id: msvc-eventos
          uri: lb://msvc-eventos
          predicates:
            - Path=/api/evento/{id:[0-9]+}
            - Method=PUT,PATCH,DELETE
          filters:
            - RewritePath=/api/evento/(?<id>[0-9]+), /evento/${id}
            - JwtAuth

        # SERVICIOS
        - id: msvc-servicios-imagen
          uri: lb://msvc-servicios
          predicates:
            - Path=/api/servicio/{id:[0-9]+}/imagenes
            - Method=GET,POST,DELETE
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}
            - JwtAuth

        - id: msvc-servicios-create
          uri: lb://msvc-servicios
          predicates:
            - Path=/api/servicio
            - Method=POST
          filters:
            - RewritePath=/api/servicio, /servicio
            - JwtAuth

        - id: msvc-servicios-update
          uri: lb://msvc-servicios
          predicates:
            - Path=/api/servicio/{id:[0-9]+}
            - Method=PUT,PATCH,DELETE
          filters:
            - RewritePath=/api/servicio/(?<id>[0-9]+), /servicio/${id}
            - JwtAuth

        # TERMAS
        - id: msvc-termas-imagen
          uri: lb://msvc-termas
          predicates:
            - Path=/api/terma/{id:[0-9]+}/imagenes
            - Method=POST,DELETE
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}
            - JwtAuth

        - id: msvc-termas-create
          uri: lb://msvc-termas
          predicates:
            - Path=/api/terma
            - Method=POST
          filters:
            - RewritePath=/api/terma, /terma
            - JwtAuth

        - id: msvc-termas-update
          uri: lb://msvc-termas
          predicates:
            - Path=/api/terma/{id:[0-9]+}
            - Method=PUT,PATCH,DELETE
          filters:
            - RewritePath=/api/terma/(?<id>[0-9]+), /terma/${id}
            - JwtAuth

        # ESPACIOS PÚBLICOS
        - id: msvc-espacios-publicos-imagen
          uri: lb://msvc-espacios-publicos
          predicates:
            - Path=/api/espacio-publico/{id:[0-9]+}/imagenes
            - Method=DELETE,POST
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}
            - JwtAuth

        - id: msvc-espacios-publicos-create
          uri: lb://msvc-espacios-publicos
          predicates:
            - Path=/api/espacio-publico
            - Method=POST
          filters:
            - RewritePath=/api/espacio-publico, /espacio-publico
            - JwtAuth

        - id: msvc-espacios-publicos-update
          uri: lb://msvc-espacios-publicos
          predicates:
            - Path=/api/espacio-publico/{id:[0-9]+}
            - Method=PUT,PATCH,DELETE
          filters:
            - RewritePath=/api/espacio-publico/(?<id>[0-9]+), /espacio-publico/${id}
            - JwtAuth

        # ========== HOME CONFIG (PÚBLICO) ==========
        - id: msvc-home-config-public
          uri: lb://msvc-user
          predicates:
            - Path=/api/home-config, /api/home-config/active, /api/home-config/seccion/{seccion}
            - Method=GET
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}

        # ========== HOME CONFIG (MODERADOR) ==========
        - id: msvc-home-config-update
          uri: lb://msvc-user
          predicates:
            - Path=/api/home-config/{id}, /api/home-config/seccion/{seccion}
            - Method=PUT
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}
            - JwtAuth

        # ========== HOME CONFIG - UPLOAD IMAGEN (MODERADOR) ==========
        - id: msvc-home-config-upload
          uri: lb://msvc-user
          predicates:
            - Path=/api/home-config/seccion/{seccion}/imagen
            - Method=POST
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}
            - JwtAuth

        # ========== USER UPLOADS (PÚBLICO) ==========
        - id: msvc-user-uploads
          uri: lb://msvc-user
          predicates:
            - Path=/api/user/uploads/**
            - Method=GET
          filters:
            - RewritePath=/api/user/uploads/(?<file>.*), /uploads/${file}

        # ========== USUARIOS (MODERADOR) ==========
        - id: msvc-user-moderador
          uri: lb://msvc-user
          predicates:
            - Path=/api/user/all, /api/user/administradores, /api/user/{id}, /api/user/{id}/role, /api/user/{id}/estado, /api/user/moderador/create
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}
            - JwtAuth

        # ========== BUSINESS (MODERADOR) ==========
        - id: msvc-business
          uri: lb://msvc-user
          predicates:
            - Path=/api/business, /api/business/**, /api/business/all, /api/business/user/{userId}, /api/business/external/{externalBusinessId}/type/{businessType}
          filters:
            - RewritePath=/api/(?<segment>.*), /${segment}
            - JwtAuth

eureka:
  client:
    service-url:
      defaultZone: http://eureka-server:8761/eureka
