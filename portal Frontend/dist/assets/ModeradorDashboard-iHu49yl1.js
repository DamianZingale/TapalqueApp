import{r as o,j as e,F as s,f as S,g as c,s as me,B as C,i as q,S as H,L as U,M as G,l as oe,h as Y,C as he,A as Z}from"./bootstrap-CYuKynBv.js";import{a as N}from"./index-BYcm0cdz.js";import"./vendor-RGnvvjkK.js";import"./router-By4bl0ai.js";import"./utils-BuyUvgGB.js";function V({images:D,onChange:A,maxImages:F=5,entityType:$="comercio",entityId:n,onPendingFile:T,pendingFiles:i=[],onRemovePendingFile:y}){const[t,x]=o.useState(""),[m,E]=o.useState(!1),z=Array.isArray(D)?D.map(f=>typeof f=="string"?f:f.imagenUrl):[],p=()=>{if(t.trim()&&z.length<F){const f=[...z,t.trim()];A(f),x("")}},I=async f=>{const g=f.target.files;if(!g||g.length===0||z.length+i.length>=F)return;const d=g[0];if(!d.type.match(/image\/(jpeg|jpg|png)/)){alert("Solo se permiten archivos JPEG, JPG o PNG");return}if(d.size>5*1024*1024){alert("El archivo no puede superar los 5MB");return}E(!0);try{const u=new FormData;if(u.append("imagen",d),n&&$){let k="";k={comercio:`/api/comercio/imagen/${n}`,hospedaje:`/api/hospedajes/${n}/imagenes`,gastronomia:`/api/restaurante/${n}/imagenes`,terma:`/api/terma/${n}/imagenes`,servicio:`/api/servicio/${n}/imagenes`,evento:`/api/evento/${n}/imagenes`,"espacio-publico":`/api/espacio-publico/${n}/imagenes`}[$]||`/api/comercio/imagen/${n}`,u.delete("imagen"),u.append("file",d),console.log("Subiendo imagen a:",k);const L=await fetch(k,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:u});if(L.ok){const h=await L.json();console.log("Imagen subida exitosamente:",h);const a=h.imagenUrl||h.url||h.message;if(a){const j=[...z,a];A(j)}else alert("La imagen se subió pero no se recibió la URL")}else{console.error("Error en respuesta del servidor:",L.status);const h=await L.json().catch(()=>({}));alert(`Error al subir imagen: ${h.message||h.error||`Error ${L.status}`}`)}}else T?T(d):alert("Debe guardar el registro primero antes de subir imágenes")}catch(u){console.error("Error subiendo imagen:",u),alert("Error de conexión al subir la imagen. Verifique que el backend esté disponible.")}finally{E(!1),f.target.value=""}},b=async f=>{const g=z[f];if(n&&$)try{const k={comercio:`/api/comercio/imagen/${n}`,hospedaje:`/api/hospedajes/${n}/imagenes`,gastronomia:`/api/restaurante/${n}/imagenes`,terma:`/api/terma/${n}/imagenes`,servicio:`/api/servicio/${n}/imagenes`,evento:`/api/evento/${n}/imagenes`,"espacio-publico":`/api/espacio-publico/${n}/imagenes`}[$]||`/api/comercio/imagen/${n}`,l=await fetch(k,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({imagenUrl:g})});l.ok||console.warn("No se pudo eliminar la imagen del servidor:",l.status)}catch(u){console.error("Error eliminando imagen del backend:",u)}const d=z.filter((u,k)=>k!==f);A(d)};return e.jsxs("div",{className:"mb-3",children:[e.jsxs(s.Label,{className:"small mb-2",children:["Imágenes (",z.length+i.length,"/",F,")"]}),z.length>0&&e.jsx(S,{className:"mb-3 g-2",children:z.map((f,g)=>e.jsx(c,{xs:6,md:4,lg:3,children:e.jsxs("div",{className:"position-relative",children:[e.jsx(me,{src:f,alt:`Imagen ${g+1}`,fluid:!0,className:"w-100 h-100",style:{objectFit:"cover",maxHeight:"120px"},onError:d=>{console.warn("Error cargando imagen:",f),d.currentTarget.src="https://via.placeholder.com/120x120/cccccc/666666?text=Error"},onLoad:()=>{console.log("Imagen cargada exitosamente:",f)}}),e.jsx(C,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0 m-1",onClick:()=>b(g),style:{fontSize:"0.7rem",padding:"0.2rem 0.4rem"},children:"×"})]})},g))}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(s.Label,{className:"small mb-2 text-warning",children:["Archivos pendientes (",i.length,") - Se subirán al guardar"]}),e.jsx(S,{className:"mb-3 g-2",children:i.map((f,g)=>e.jsx(c,{xs:6,md:4,lg:3,children:e.jsxs("div",{className:"position-relative border border-warning rounded p-1",children:[e.jsx(me,{src:URL.createObjectURL(f),alt:`Pendiente ${g+1}`,fluid:!0,className:"w-100 h-100",style:{objectFit:"cover",maxHeight:"120px"}}),y&&e.jsx(C,{variant:"warning",size:"sm",className:"position-absolute top-0 end-0 m-1",onClick:()=>y(g),style:{fontSize:"0.7rem",padding:"0.2rem 0.4rem"},children:"×"}),e.jsx("small",{className:"d-block text-center text-muted text-truncate",style:{fontSize:"0.65rem"},children:f.name})]})},`pending-${g}`))})]}),z.length+i.length<F&&e.jsxs(S,{className:"g-2",children:[e.jsx(c,{md:6,children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(s.Control,{size:"sm",type:"url",placeholder:"https://ejemplo.com/imagen.jpg",value:t,onChange:f=>x(f.target.value),onKeyPress:f=>f.key==="Enter"&&p()}),e.jsx(C,{size:"sm",variant:"outline-primary",onClick:p,children:"Agregar URL"})]})}),e.jsxs(c,{md:6,children:[e.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[e.jsx(s.Control,{type:"file",size:"sm",accept:".jpg,.jpeg,.png",onChange:I,disabled:m}),m&&e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Subiendo..."})})]}),e.jsx("small",{className:"text-muted",children:"JPEG, JPG, PNG (máx. 5MB)"})]})]}),z.length+i.length>=F&&e.jsxs(q,{variant:"info",className:"py-2 small",children:["Máximo de ",F," imágenes alcanzado"]})]})}const xe={getComercios:()=>N.get("/comercio/list"),getComercioById:D=>N.get(`/comercio/${D}`),createComercio:D=>N.post("/comercio",D),updateComercio:(D,A)=>N.put(`/comercio/${D}`,A),deleteComercio:D=>N.delete(`/comercio/${D}`),getAdministradores:()=>N.get("/user/administradores")},ee={titulo:"",descripcion:"",direccion:"",horario:"",telefono:"",latitud:void 0,longitud:void 0,facebook:"",instagram:"",imagenes:[]};function ge(){const[D,A]=o.useState([]),[F,$]=o.useState(!0),[n,T]=o.useState(null),[i,y]=o.useState(!1),[t,x]=o.useState(ee),[m,E]=o.useState(!1),[z,p]=o.useState(null),[I,b]=o.useState(!1),[f,g]=o.useState([]);o.useEffect(()=>{d()},[]);const d=async()=>{try{$(!0);const a=await xe.getComercios();A(a.data),console.log("Datos cargados desde API:",a.data)}catch(a){console.error("Error cargando datos:",a),A([])}finally{$(!1)}},u=a=>{console.log("Item seleccionado:",a),T(a),y(!1),x({...a}),g([])},k=()=>{T(null),y(!0),x({...ee}),g([])},l=(a,j)=>{x(w=>({...w,[a]:j}))},L=async()=>{if(!t.titulo){p({tipo:"danger",texto:"Título requerido"});return}E(!0);try{const a=i?"/comercio":`/comercio/${n?.id}`,{id:j,imagenes:w,...M}=t,P={...i?M:{...M,id:t.id},descripcion:t.descripcion?.trim()||"",telefono:t.telefono?.trim()||void 0,facebook:t.facebook?.trim()||void 0,instagram:t.instagram?.trim()||void 0,latitud:t.latitud||void 0,longitud:t.longitud||void 0};console.log("Enviando datos:",P),console.log("URL:",a);const J=i?await N.post(a,P):await N.patch(a,P);console.log("Respuesta:",J.data);const r=J.data,v=i?r.id:n?.id;if(f.length>0&&v){for(const R of f){const B=new FormData;B.append("file",R);try{await N.post(`/comercio/imagen/${v}`,B,{headers:{"Content-Type":"multipart/form-data"}})}catch(_){console.error("Error subiendo imagen:",_)}}g([])}p({tipo:"success",texto:i?"Creado":"Actualizado"}),d(),i&&(y(!1),x(ee))}catch(a){console.error("Error en handleSave:",a);const j=a.response?.data||{};p({tipo:"danger",texto:j.message||j.error||"Error de conexión"})}finally{E(!1),setTimeout(()=>p(null),3e3)}},h=async()=>{if(n)try{await N.delete(`/comercio/${n.id}`),p({tipo:"success",texto:"Eliminado"}),T(null),x(ee),d()}catch(a){console.error("Error en handleDelete:",a);const j=a.response?.data||{};p({tipo:"danger",texto:j.message||j.error||"Error al eliminar"})}finally{b(!1),setTimeout(()=>p(null),3e3)}};return F?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(H,{size:"sm"})," Cargando..."]}):e.jsxs(S,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(C,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:k,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Agregar nuevo"})]}),e.jsxs(U,{style:{maxHeight:400,overflowY:"auto"},children:[D.map(a=>e.jsxs(U.Item,{action:!0,active:n?.id===a.id,onClick:()=>u(a),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:a.titulo}),e.jsx("small",{className:"text-muted",children:a.direccion})]},a.id)),D.length===0&&e.jsx(U.Item,{className:"text-muted",children:"Sin registros"})]})]}),e.jsxs(c,{md:8,children:[z&&e.jsx(q,{variant:z.tipo,className:"py-1 small",children:z.texto}),n||i?e.jsxs(s,{children:[e.jsx("h6",{children:i?"Nuevo Comercio":`Editando: ${n?.titulo}`}),!i&&n&&e.jsx(S,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:n.id,disabled:!0})]})})}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Título *"}),e.jsx(s.Control,{size:"sm",value:t.titulo||"",onChange:a=>l("titulo",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Teléfono"}),e.jsx(s.Control,{size:"sm",value:t.telefono||"",onChange:a=>l("telefono",a.target.value)})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Descripción"}),e.jsx(s.Control,{size:"sm",as:"textarea",rows:2,value:t.descripcion||"",onChange:a=>l("descripcion",a.target.value)})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Dirección"}),e.jsx(s.Control,{size:"sm",value:t.direccion||"",onChange:a=>l("direccion",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Horario"}),e.jsx(s.Control,{size:"sm",value:t.horario||"",onChange:a=>l("horario",a.target.value)})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Latitud"}),e.jsx(s.Control,{size:"sm",type:"number",step:"any",value:t.latitud??"",onChange:a=>l("latitud",parseFloat(a.target.value)||0)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Longitud"}),e.jsx(s.Control,{size:"sm",type:"number",step:"any",value:t.longitud??"",onChange:a=>l("longitud",parseFloat(a.target.value)||0)})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Facebook"}),e.jsx(s.Control,{size:"sm",value:t.facebook||"",onChange:a=>l("facebook",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Instagram"}),e.jsx(s.Control,{size:"sm",value:t.instagram||"",onChange:a=>l("instagram",a.target.value)})]})})]}),e.jsx(V,{images:t.imagenes||[],onChange:a=>x(j=>({...j,imagenes:a.map(w=>({imagenUrl:w}))})),maxImages:5,entityType:"comercio",entityId:n?.id,pendingFiles:f,onPendingFile:a=>g(j=>[...j,a]),onRemovePendingFile:a=>g(j=>j.filter((w,M)=>M!==a))}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(C,{size:"sm",variant:"primary",onClick:L,disabled:m,children:m?e.jsx(H,{size:"sm"}):i?"Crear":"Guardar"}),!i&&n&&e.jsx(C,{size:"sm",variant:"outline-danger",onClick:()=>b(!0),children:"Eliminar"}),e.jsx(C,{size:"sm",variant:"secondary",onClick:()=>{T(null),y(!1)},children:"Cancelar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un item o crea uno nuevo"})]}),e.jsxs(G,{show:I,onHide:()=>b(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Confirmar eliminación"})}),e.jsxs(G.Body,{children:['¿Eliminar "',n?.titulo,'"?']}),e.jsxs(G.Footer,{children:[e.jsx(C,{variant:"secondary",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(C,{variant:"danger",onClick:h,children:"Eliminar"})]})]})]})}const ce={COMERCIO:"Comercios",GASTRONOMIA:"Gastronomía",HOSPEDAJE:"Hospedajes",SERVICIOS:"Servicios",ESPACIOS:"Espacios Públicos",EVENTOS:"Eventos",TERMAS:"Termas"};function je(){const[D,A]=o.useState([]),[F,$]=o.useState(!0),[n,T]=o.useState(null),[i,y]=o.useState(null),[t,x]=o.useState(null),[m,E]=o.useState({}),z=o.useRef({});o.useEffect(()=>{p()},[]);const p=async()=>{try{$(!0);const u=(await N.get("/home-config")).data||[];A(u);const k={};u.forEach(l=>{k[l.seccion]=l.imagenUrl||""}),E(k)}catch(d){console.error("Error cargando configuración del home:",d),A([])}finally{$(!1)}},I=(d,u)=>{E(k=>({...k,[d]:u}))},b=async d=>{T(d);try{await N.put(`/home-config/seccion/${d}`,{imagenUrl:m[d]||null}),x({tipo:"success",texto:`Imagen de ${ce[d]} actualizada`}),p()}catch(u){console.error("Error guardando:",u),x({tipo:"danger",texto:u.response?.data?.message||"Error al guardar"})}finally{T(null),setTimeout(()=>x(null),3e3)}},f=d=>{z.current[d]?.click()},g=async(d,u)=>{if(u){if(!u.type.startsWith("image/")){x({tipo:"danger",texto:"El archivo debe ser una imagen"}),setTimeout(()=>x(null),3e3);return}if(u.size>5*1024*1024){x({tipo:"danger",texto:"La imagen no debe superar 5MB"}),setTimeout(()=>x(null),3e3);return}y(d);try{const k=new FormData;k.append("file",u);const l=await N.post(`/home-config/seccion/${d}/imagen`,k,{headers:{"Content-Type":"multipart/form-data"}});x({tipo:"success",texto:`Imagen de ${ce[d]} subida correctamente`}),l.data?.imagenUrl&&E(L=>({...L,[d]:l.data.imagenUrl})),p()}catch(k){console.error("Error subiendo imagen:",k),x({tipo:"danger",texto:k.response?.data?.error||"Error al subir imagen"})}finally{y(null),setTimeout(()=>x(null),3e3)}}};return F?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(H,{size:"sm"})," Cargando configuración..."]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-muted small mb-3",children:"Configura las imágenes de fondo para cada sección del Home. Puedes subir una imagen o pegar una URL externa."}),t&&e.jsx(q,{variant:t.tipo,className:"py-2 small",children:t.texto}),e.jsx(S,{className:"g-3",children:D.map(d=>e.jsx(c,{md:6,lg:4,children:e.jsxs(oe,{className:"h-100",children:[e.jsx(oe.Header,{className:"py-2",children:e.jsx("strong",{className:"small",children:ce[d.seccion]||d.seccion})}),e.jsxs(oe.Body,{className:"p-2",children:[e.jsx("div",{className:"mb-2 rounded position-relative",style:{height:"100px",backgroundImage:m[d.seccion]?`url(${m[d.seccion]})`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundSize:"cover",backgroundPosition:"center",border:"1px solid #dee2e6"},children:i===d.seccion&&e.jsx("div",{className:"position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx(H,{size:"sm",variant:"light"})})}),e.jsx("input",{type:"file",accept:"image/*",ref:u=>{z.current[d.seccion]=u},style:{display:"none"},onChange:u=>{const k=u.target.files?.[0];k&&g(d.seccion,k),u.target.value=""}}),e.jsx(C,{size:"sm",variant:"outline-primary",className:"w-100 mb-2",onClick:()=>f(d.seccion),disabled:i===d.seccion||n===d.seccion,children:i===d.seccion?e.jsxs(e.Fragment,{children:[e.jsx(H,{size:"sm",className:"me-1"})," Subiendo..."]}):"Subir imagen"}),e.jsx("div",{className:"text-center small text-muted mb-2",children:"- o usar URL -"}),e.jsx(s.Group,{className:"mb-2",children:e.jsx(s.Control,{size:"sm",type:"url",placeholder:"https://ejemplo.com/imagen.jpg",value:m[d.seccion]||"",onChange:u=>I(d.seccion,u.target.value)})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(C,{size:"sm",variant:"primary",onClick:()=>b(d.seccion),disabled:n===d.seccion||i===d.seccion,className:"flex-grow-1",children:n===d.seccion?e.jsx(H,{size:"sm"}):"Guardar URL"}),e.jsx(C,{size:"sm",variant:"outline-secondary",onClick:()=>I(d.seccion,d.imagenUrl||""),disabled:n===d.seccion||i===d.seccion,children:"Restaurar"})]}),d.updatedAt&&e.jsxs("small",{className:"text-muted d-block mt-2",children:["Actualizado: ",new Date(d.updatedAt).toLocaleDateString()]})]})]})},d.seccion))}),D.length===0&&e.jsx(q,{variant:"info",className:"mt-3",children:"No hay configuraciones. Se crearán automáticamente al iniciar el backend."})]})}const se={titulo:"",descripcion:"",direccion:"",telefono:"",latitud:void 0,longitud:void 0,facebook:"",instagram:"",twitter:"",tiktok:"",categoria:"",horario:"",imagenes:[]};function pe(){const[D,A]=o.useState([]),[F,$]=o.useState(!0),[n,T]=o.useState(null),[i,y]=o.useState(!1),[t,x]=o.useState(se),[m,E]=o.useState(!1),[z,p]=o.useState(null),[I,b]=o.useState(!1),[f,g]=o.useState([]);o.useEffect(()=>{d()},[]);const d=async()=>{try{$(!0);const a=await N.get("/espacio-publico");A(a.data||[])}catch(a){console.error("Error:",a)}finally{$(!1)}},u=a=>{T(a),y(!1),x({...a}),g([])},k=()=>{T(null),y(!0),x({...se}),g([])},l=(a,j)=>{x(w=>({...w,[a]:j}))},L=async()=>{if(!t.titulo){p({tipo:"danger",texto:"Título requerido"});return}E(!0);try{const a=i?"/espacio-publico":`/espacio-publico/${n?.id}`,{id:j,imagenes:w,...M}=t,P={...i?M:{...M,id:t.id},descripcion:t.descripcion?.trim()||void 0,telefono:t.telefono?.trim()||void 0,facebook:t.facebook?.trim()||void 0,instagram:t.instagram?.trim()||void 0,twitter:t.twitter?.trim()||void 0,tiktok:t.tiktok?.trim()||void 0,categoria:t.categoria?.trim()||void 0,horario:t.horario?.trim()||void 0,latitud:t.latitud||void 0,longitud:t.longitud||void 0},r=(i?await N.post(a,P):await N.put(a,P)).data,v=i?r.id:n?.id;if(f.length>0&&v){for(const R of f){const B=new FormData;B.append("file",R);try{await N.post(`/espacio-publico/${v}/imagenes`,B,{headers:{"Content-Type":"multipart/form-data"}})}catch(_){console.error("Error subiendo imagen:",_)}}g([])}p({tipo:"success",texto:i?"Creado":"Actualizado"}),d(),i&&(y(!1),x(se))}catch{p({tipo:"danger",texto:"Error de conexión"})}finally{E(!1),setTimeout(()=>p(null),3e3)}},h=async()=>{if(n)try{await N.delete(`/espacio-publico/${n.id}`),p({tipo:"success",texto:"Eliminado"}),T(null),x(se),d()}catch{p({tipo:"danger",texto:"Error al eliminar"})}finally{b(!1),setTimeout(()=>p(null),3e3)}};return F?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(H,{size:"sm"})," Cargando..."]}):e.jsxs(S,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(C,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:k,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Agregar nuevo"})]}),e.jsxs(U,{style:{maxHeight:400,overflowY:"auto"},children:[D.map(a=>e.jsxs(U.Item,{action:!0,active:n?.id===a.id,onClick:()=>u(a),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:a.titulo}),e.jsx("small",{className:"text-muted",children:a.categoria||a.direccion})]},a.id)),D.length===0&&e.jsx(U.Item,{className:"text-muted",children:"Sin registros"})]})]}),e.jsxs(c,{md:8,children:[z&&e.jsx(q,{variant:z.tipo,className:"py-1 small",children:z.texto}),n||i?e.jsxs(s,{children:[e.jsx("h6",{children:i?"Nuevo Espacio Público":`Editando: ${n?.titulo}`}),!i&&n&&e.jsx(S,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:n.id,disabled:!0})]})})}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Título *"}),e.jsx(s.Control,{size:"sm",value:t.titulo||"",onChange:a=>l("titulo",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Categoría"}),e.jsx(s.Control,{size:"sm",value:t.categoria||"",onChange:a=>l("categoria",a.target.value)})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Descripción"}),e.jsx(s.Control,{size:"sm",as:"textarea",rows:2,value:t.descripcion||"",onChange:a=>l("descripcion",a.target.value)})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Dirección"}),e.jsx(s.Control,{size:"sm",value:t.direccion||"",onChange:a=>l("direccion",a.target.value)})]})}),e.jsx(c,{md:3,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Teléfono"}),e.jsx(s.Control,{size:"sm",value:t.telefono||"",onChange:a=>l("telefono",a.target.value)})]})}),e.jsx(c,{md:3,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Horario"}),e.jsx(s.Control,{size:"sm",value:t.horario||"",onChange:a=>l("horario",a.target.value)})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Latitud"}),e.jsx(s.Control,{size:"sm",type:"number",step:"any",value:t.latitud??"",onChange:a=>l("latitud",parseFloat(a.target.value)||0)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Longitud"}),e.jsx(s.Control,{size:"sm",type:"number",step:"any",value:t.longitud??"",onChange:a=>l("longitud",parseFloat(a.target.value)||0)})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:3,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Facebook"}),e.jsx(s.Control,{size:"sm",value:t.facebook||"",onChange:a=>l("facebook",a.target.value)})]})}),e.jsx(c,{md:3,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Instagram"}),e.jsx(s.Control,{size:"sm",value:t.instagram||"",onChange:a=>l("instagram",a.target.value)})]})}),e.jsx(c,{md:3,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Twitter"}),e.jsx(s.Control,{size:"sm",value:t.twitter||"",onChange:a=>l("twitter",a.target.value)})]})}),e.jsx(c,{md:3,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"TikTok"}),e.jsx(s.Control,{size:"sm",value:t.tiktok||"",onChange:a=>l("tiktok",a.target.value)})]})})]}),e.jsx(V,{images:t.imagenes||[],onChange:a=>x(j=>({...j,imagenes:a.map(w=>({imagenUrl:w}))})),maxImages:5,entityType:"espacio-publico",entityId:n?.id,pendingFiles:f,onPendingFile:a=>g(j=>[...j,a]),onRemovePendingFile:a=>g(j=>j.filter((w,M)=>M!==a))}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(C,{size:"sm",variant:"primary",onClick:L,disabled:m,children:m?e.jsx(H,{size:"sm"}):i?"Crear":"Guardar"}),!i&&n&&e.jsx(C,{size:"sm",variant:"outline-danger",onClick:()=>b(!0),children:"Eliminar"}),e.jsx(C,{size:"sm",variant:"secondary",onClick:()=>{T(null),y(!1)},children:"Cancelar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un item o crea uno nuevo"})]}),e.jsxs(G,{show:I,onHide:()=>b(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Confirmar"})}),e.jsxs(G.Body,{children:['¿Eliminar "',n?.titulo,'"?']}),e.jsxs(G.Footer,{children:[e.jsx(C,{variant:"secondary",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(C,{variant:"danger",onClick:h,children:"Eliminar"})]})]})]})}const ae={nombreEvento:"",lugar:"",horario:"",fechaInicio:"",fechaFin:"",telefonoContacto:"",nombreContacto:"",imagenes:[]};function ve(){const[D,A]=o.useState([]),[F,$]=o.useState(!0),[n,T]=o.useState(null),[i,y]=o.useState(!1),[t,x]=o.useState(ae),[m,E]=o.useState(!1),[z,p]=o.useState(null),[I,b]=o.useState(!1),[f,g]=o.useState([]);o.useEffect(()=>{d()},[]);const d=async()=>{try{$(!0);const a=await N.get("/evento");A(a.data||[])}catch(a){console.error("Error:",a)}finally{$(!1)}},u=a=>{T(a),y(!1),x({...a}),g([])},k=()=>{T(null),y(!0),x({...ae}),g([])},l=(a,j)=>{x(w=>({...w,[a]:j}))},L=async()=>{if(!t.nombreEvento){p({tipo:"danger",texto:"Nombre requerido"});return}E(!0);try{const a=i?"/evento":`/evento/${n?.id}`,{id:j,imagenes:w,...M}=t,P={...i?M:{...M,id:t.id}},r=(i?await N.post(a,P):await N.put(a,P)).data,v=i?r.id:n?.id;if(f.length>0&&v){for(const R of f){const B=new FormData;B.append("file",R);try{await N.post(`/evento/${v}/imagenes`,B,{headers:{"Content-Type":"multipart/form-data"}})}catch(_){console.error("Error subiendo imagen:",_)}}g([])}p({tipo:"success",texto:i?"Creado":"Actualizado"}),d(),i&&(y(!1),x(ae))}catch{p({tipo:"danger",texto:"Error de conexión"})}finally{E(!1),setTimeout(()=>p(null),3e3)}},h=async()=>{if(n)try{await N.delete(`/evento/${n.id}`),p({tipo:"success",texto:"Eliminado"}),T(null),x(ae),d()}catch{p({tipo:"danger",texto:"Error al eliminar"})}finally{b(!1),setTimeout(()=>p(null),3e3)}};return F?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(H,{size:"sm"})," Cargando..."]}):e.jsxs(S,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(C,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:k,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Agregar nuevo"})]}),e.jsxs(U,{style:{maxHeight:400,overflowY:"auto"},children:[D.map(a=>e.jsxs(U.Item,{action:!0,active:n?.id===a.id,onClick:()=>u(a),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:a.nombreEvento}),e.jsxs("small",{className:"text-muted",children:[a.fechaInicio," - ",a.lugar]})]},a.id)),D.length===0&&e.jsx(U.Item,{className:"text-muted",children:"Sin registros"})]})]}),e.jsxs(c,{md:8,children:[z&&e.jsx(q,{variant:z.tipo,className:"py-1 small",children:z.texto}),n||i?e.jsxs(s,{children:[e.jsx("h6",{children:i?"Nuevo Evento":`Editando: ${n?.nombreEvento}`}),!i&&n&&e.jsx(S,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:n.id,disabled:!0})]})})}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Nombre *"}),e.jsx(s.Control,{size:"sm",value:t.nombreEvento||"",onChange:a=>l("nombreEvento",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Lugar *"}),e.jsx(s.Control,{size:"sm",value:t.lugar||"",onChange:a=>l("lugar",a.target.value)})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Fecha Inicio *"}),e.jsx(s.Control,{size:"sm",type:"date",value:t.fechaInicio||"",onChange:a=>l("fechaInicio",a.target.value)})]})}),e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Fecha Fin"}),e.jsx(s.Control,{size:"sm",type:"date",value:t.fechaFin||"",onChange:a=>l("fechaFin",a.target.value)})]})}),e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Horario *"}),e.jsx(s.Control,{size:"sm",value:t.horario||"",onChange:a=>l("horario",a.target.value)})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Nombre Contacto *"}),e.jsx(s.Control,{size:"sm",value:t.nombreContacto||"",onChange:a=>l("nombreContacto",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Teléfono Contacto *"}),e.jsx(s.Control,{size:"sm",value:t.telefonoContacto||"",onChange:a=>l("telefonoContacto",a.target.value)})]})})]}),e.jsx(V,{images:t.imagenes||[],onChange:a=>x(j=>({...j,imagenes:a.map(w=>({imagenUrl:w}))})),maxImages:5,entityType:"evento",entityId:n?.id,pendingFiles:f,onPendingFile:a=>g(j=>[...j,a]),onRemovePendingFile:a=>g(j=>j.filter((w,M)=>M!==a))}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(C,{size:"sm",variant:"primary",onClick:L,disabled:m,children:m?e.jsx(H,{size:"sm"}):i?"Crear":"Guardar"}),!i&&n&&e.jsx(C,{size:"sm",variant:"outline-danger",onClick:()=>b(!0),children:"Eliminar"}),e.jsx(C,{size:"sm",variant:"secondary",onClick:()=>{T(null),y(!1)},children:"Cancelar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un item o crea uno nuevo"})]}),e.jsxs(G,{show:I,onHide:()=>b(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Confirmar"})}),e.jsxs(G.Body,{children:['¿Eliminar "',n?.nombreEvento,'"?']}),e.jsxs(G.Footer,{children:[e.jsx(C,{variant:"secondary",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(C,{variant:"danger",onClick:h,children:"Eliminar"})]})]})]})}const te={name:"",address:"",email:"",latitude:void 0,longitude:void 0,categories:"",phones:"",schedule:"",delivery:!1,imagenes:[],userId:void 0};function be(){const[D,A]=o.useState([]),[F,$]=o.useState([]),[n,T]=o.useState(!0),[i,y]=o.useState(null),[t,x]=o.useState(!1),[m,E]=o.useState(te),[z,p]=o.useState(!1),[I,b]=o.useState(null),[f,g]=o.useState(!1),[d,u]=o.useState(null),[k,l]=o.useState([]);o.useEffect(()=>{L(),h()},[]);const L=async()=>{try{T(!0);const r=await N.get("/gastronomia/restaurants");A(r.data||[])}catch(r){console.error("Error:",r)}finally{T(!1)}},h=async()=>{try{const r=await N.get("/user/administradores");$(r.data||[])}catch(r){console.error("Error cargando administradores:",r)}},a=async r=>{y(r),x(!1),E({...r}),l([]),await M(r.id)},j=()=>{y(null),x(!0),E({...te}),b(null),u(null),l([])},w=(r,v)=>{E(R=>({...R,[r]:v}))},M=async r=>{try{const v=await N.get(`/business/external/${r}/type/GASTRONOMIA`);u(v.data),E(R=>({...R,userId:v.data.ownerId}))}catch(v){v?.response?.status===404?(u(null),E(R=>({...R,userId:void 0}))):(console.error("Error loading business:",v),u(null))}},P=async()=>{if(!m.name){b({tipo:"danger",texto:"Nombre requerido"});return}p(!0);try{const r=t?"/gastronomia":`/gastronomia/${i?.id}`,{id:v,imagenes:R,userId:B,..._}=m,K={...t?_:{..._,id:m.id},address:m.address?.trim()||void 0,email:m.email?.trim()||void 0,categories:m.categories?.trim()||void 0,phones:m.phones?.trim()||void 0,schedule:m.schedule?.trim()||void 0,latitude:m.latitude||void 0,longitude:m.longitude||void 0},Q=(t?await N.post(r,K):await N.put(r,K)).data,X=t?Q.id:i?.id;if(k.length>0&&X){for(const O of k){const W=new FormData;W.append("file",O);try{await N.post(`/restaurante/${X}/imagenes`,W,{headers:{"Content-Type":"multipart/form-data"}})}catch(ie){console.error("Error subiendo imagen:",ie)}}l([])}if(t&&m.userId){const O={ownerId:m.userId,name:m.name,businessType:"GASTRONOMIA",externalBusinessId:Q.id};try{await N.post("/business",O)}catch{console.warn("No se pudo asignar el administrador al negocio")}}if(!t&&d&&m.userId&&m.userId!==d.ownerId){const O={ownerId:m.userId};try{const W=await N.patch(`/business/${d.id}/owner`,O);u(W.data)}catch{console.warn("No se pudo actualizar el administrador del negocio")}}if(!t&&!d&&m.userId&&i?.id){const O={ownerId:m.userId,name:m.name,businessType:"GASTRONOMIA",externalBusinessId:i.id};try{const W=await N.post("/business",O);u(W.data)}catch{console.warn("No se pudo crear el administrador del negocio")}}b({tipo:"success",texto:t?"Creado":"Actualizado"}),L(),t&&(x(!1),E(te))}catch{b({tipo:"danger",texto:"Error de conexión"})}finally{p(!1),setTimeout(()=>b(null),3e3)}},J=async()=>{if(i)try{await N.delete(`/gastronomia/delete/${i.id}`),b({tipo:"success",texto:"Eliminado"}),y(null),E(te),L()}catch{b({tipo:"danger",texto:"Error al eliminar"})}finally{g(!1),setTimeout(()=>b(null),3e3)}};return n?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(H,{size:"sm"})," Cargando..."]}):e.jsxs(S,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(C,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:j,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Agregar nuevo"})]}),e.jsxs(U,{style:{maxHeight:400,overflowY:"auto"},children:[D.map(r=>e.jsxs(U.Item,{action:!0,active:i?.id===r.id,onClick:()=>a(r),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:r.name}),e.jsx("small",{className:"text-muted",children:r.address||r.categories})]},r.id)),D.length===0&&e.jsx(U.Item,{className:"text-muted",children:"Sin registros"})]})]}),e.jsxs(c,{md:8,children:[I&&e.jsx(q,{variant:I.tipo,className:"py-1 small",children:I.texto}),i||t?e.jsxs(s,{children:[e.jsx("h6",{children:t?"Nuevo Local Gastronómico":`Editando: ${i?.name}`}),!t&&i&&e.jsx(S,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:i.id,disabled:!0})]})})}),e.jsx(S,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"Administrador/Dueño"}),e.jsxs(s.Select,{size:"sm",value:m.userId||"",onChange:r=>{const v=r.target.value;w("userId",v?parseInt(v):void 0)},children:[e.jsx("option",{value:"",children:"Seleccionar administrador..."}),F.map(r=>e.jsxs("option",{value:r.id,children:[r.firstName," ",r.lastName," (",r.email,")"]},r.id))]})]})})}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Nombre *"}),e.jsx(s.Control,{size:"sm",value:m.name||"",onChange:r=>w("name",r.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Email"}),e.jsx(s.Control,{size:"sm",type:"email",value:m.email||"",onChange:r=>w("email",r.target.value)})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Dirección"}),e.jsx(s.Control,{size:"sm",value:m.address||"",onChange:r=>w("address",r.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Categorías"}),e.jsx(s.Control,{size:"sm",value:m.categories||"",onChange:r=>w("categories",r.target.value),placeholder:"Pizza, Empanadas"})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Teléfonos"}),e.jsx(s.Control,{size:"sm",value:m.phones||"",onChange:r=>w("phones",r.target.value),placeholder:"123456, 789012"})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Horarios"}),e.jsx(s.Control,{size:"sm",value:m.schedule||"",onChange:r=>w("schedule",r.target.value),placeholder:"1:09:00-22:00; 2:09:00-22:00"})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Latitud"}),e.jsx(s.Control,{size:"sm",type:"number",step:"any",value:m.latitude??"",onChange:r=>w("latitude",parseFloat(r.target.value)||0)})]})}),e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Longitud"}),e.jsx(s.Control,{size:"sm",type:"number",step:"any",value:m.longitude??"",onChange:r=>w("longitude",parseFloat(r.target.value)||0)})]})}),e.jsx(c,{md:4,children:e.jsx(s.Group,{className:"mb-2 pt-4",children:e.jsx(s.Check,{type:"checkbox",label:"Delivery",checked:m.delivery||!1,onChange:r=>w("delivery",r.target.checked)})})})]}),e.jsx(V,{images:m.imagenes||[],onChange:r=>E(v=>({...v,imagenes:r.map(R=>({imagenUrl:R}))})),maxImages:5,entityType:"gastronomia",entityId:i?.id,pendingFiles:k,onPendingFile:r=>l(v=>[...v,r]),onRemovePendingFile:r=>l(v=>v.filter((R,B)=>B!==r))}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(C,{size:"sm",variant:"primary",onClick:P,disabled:z,children:z?e.jsx(H,{size:"sm"}):t?"Crear":"Guardar"}),!t&&i&&e.jsx(C,{size:"sm",variant:"outline-danger",onClick:()=>g(!0),children:"Eliminar"}),e.jsx(C,{size:"sm",variant:"secondary",onClick:()=>{y(null),x(!1),b(null)},children:"Cancelar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un item o crea uno nuevo"})]}),e.jsxs(G,{show:f,onHide:()=>g(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Confirmar"})}),e.jsxs(G.Body,{children:['¿Eliminar "',i?.name,'"?']}),e.jsxs(G.Footer,{children:[e.jsx(C,{variant:"secondary",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(C,{variant:"danger",onClick:J,children:"Eliminar"})]})]})]})}const re={titulo:"",description:"",ubicacion:"",googleMapsUrl:"",numWhatsapp:"",tipoHospedaje:"HOTEL",imagenes:[],userId:void 0};function fe(){const[D,A]=o.useState([]),[F,$]=o.useState([]),[n,T]=o.useState(!0),[i,y]=o.useState(null),[t,x]=o.useState(!1),[m,E]=o.useState(re),[z,p]=o.useState(!1),[I,b]=o.useState(null),[f,g]=o.useState(!1),[d,u]=o.useState(null),[k,l]=o.useState([]);o.useEffect(()=>{L(),h()},[]);const L=async()=>{try{T(!0);const r=await N.get("/hospedajes");A(r.data||[]),console.log("Hospedajes cargados desde API:",r.data)}catch(r){console.error("Error cargando hospedajes:",r),A([])}finally{T(!1)}},h=async()=>{try{const r=await N.get("/user/administradores");$(r.data||[])}catch(r){console.error("Error cargando administradores:",r)}},a=async r=>{console.log("Hospedaje seleccionado:",r),y(r),x(!1),E({...r}),l([]),await M(r.id)},j=()=>{y(null),x(!0),E({...re}),u(null),l([])},w=(r,v)=>{E(R=>({...R,[r]:v}))},M=async r=>{try{const v=await N.get(`/business/external/${r}/type/HOSPEDAJE`);u(v.data),E(R=>({...R,userId:v.data.ownerId}))}catch(v){v?.response?.status===404?(u(null),E(R=>({...R,userId:void 0}))):(console.error("Error loading business:",v),u(null))}},P=async()=>{if(!m.titulo){b({tipo:"danger",texto:"Título requerido"});return}p(!0);try{const r=t?"/hospedajes":`/hospedajes/${i?.id}`,{id:v,imagenes:R,userId:B,..._}=m,K={...t?_:{..._,id:m.id},description:m.description?.trim()||"",ubicacion:m.ubicacion?.trim()||void 0,googleMapsUrl:m.googleMapsUrl?.trim()||void 0,numWhatsapp:m.numWhatsapp?.trim()||void 0};console.log("Enviando hospedaje:",K),console.log("URL:",r);const ne=t?await N.post(r,K):await N.put(r,K);console.log("Respuesta:",ne.data);const Q=ne.data,X=t?Q.id:i?.id;if(k.length>0&&X){for(const O of k){const W=new FormData;W.append("file",O);try{await N.post(`/hospedajes/${X}/imagenes`,W,{headers:{"Content-Type":"multipart/form-data"}})}catch(ie){console.error("Error subiendo imagen:",ie)}}l([])}if(t&&m.userId){const O={ownerId:m.userId,name:m.titulo,businessType:"HOSPEDAJE",externalBusinessId:Q.id};try{await N.post("/business",O)}catch{console.warn("No se pudo asignar el administrador al negocio")}}if(!t&&d&&m.userId&&m.userId!==d.ownerId){const O={ownerId:m.userId};try{const W=await N.patch(`/business/${d.id}/owner`,O);u(W.data)}catch{console.warn("No se pudo actualizar el administrador del negocio")}}if(!t&&!d&&m.userId&&i?.id){const O={ownerId:m.userId,name:m.titulo,businessType:"HOSPEDAJE",externalBusinessId:i.id};try{const W=await N.post("/business",O);u(W.data)}catch{console.warn("No se pudo crear el administrador del negocio")}}b({tipo:"success",texto:t?"Creado":"Actualizado"}),L(),t&&(x(!1),E(re))}catch(r){console.error("Error en handleSave de hospedaje:",r);const v=r.response?.data||{};b({tipo:"danger",texto:v.message||v.error||"Error de conexión"})}finally{p(!1),setTimeout(()=>b(null),3e3)}},J=async()=>{if(i)try{await N.delete(`/hospedajes/${i.id}`),b({tipo:"success",texto:"Eliminado"}),y(null),E(re),L()}catch(r){console.error("Error en handleDelete de hospedaje:",r);const v=r.response?.data||{};b({tipo:"danger",texto:v.message||v.error||"Error al eliminar"})}finally{g(!1),setTimeout(()=>b(null),3e3)}};return n?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(H,{size:"sm"})," Cargando..."]}):e.jsxs(S,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(C,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:j,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Agregar nuevo"})]}),e.jsxs(U,{style:{maxHeight:400,overflowY:"auto"},children:[D.map(r=>e.jsxs(U.Item,{action:!0,active:i?.id===r.id,onClick:()=>a(r),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:r.titulo}),e.jsxs("small",{className:"text-muted",children:[r.tipoHospedaje," - ",r.ubicacion]})]},r.id)),D.length===0&&e.jsx(U.Item,{className:"text-muted",children:"Sin registros"})]})]}),e.jsxs(c,{md:8,children:[I&&e.jsx(q,{variant:I.tipo,className:"py-1 small",children:I.texto}),i||t?e.jsxs(s,{children:[e.jsx("h6",{children:t?"Nuevo Hospedaje":`Editando: ${i?.titulo}`}),!t&&i&&e.jsx(S,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:i.id,disabled:!0})]})})}),e.jsx(S,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"Administrador/Dueño"}),e.jsxs(s.Select,{size:"sm",value:m.userId||"",onChange:r=>{const v=r.target.value;w("userId",v?parseInt(v):void 0)},children:[e.jsx("option",{value:"",children:"Seleccionar administrador..."}),F.map(r=>e.jsxs("option",{value:r.id,children:[r.firstName," ",r.lastName," (",r.email,")"]},r.id))]})]})})}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Título *"}),e.jsx(s.Control,{size:"sm",value:m.titulo||"",onChange:r=>w("titulo",r.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Tipo *"}),e.jsxs(s.Select,{size:"sm",value:m.tipoHospedaje||"HOTEL",onChange:r=>w("tipoHospedaje",r.target.value),children:[e.jsx("option",{value:"HOTEL",children:"Hotel"}),e.jsx("option",{value:"DEPARTAMENTO",children:"Departamento"}),e.jsx("option",{value:"CABAÑA",children:"Cabaña"}),e.jsx("option",{value:"CASA",children:"Casa"}),e.jsx("option",{value:"OTRO",children:"Otro"})]})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Descripción"}),e.jsx(s.Control,{size:"sm",as:"textarea",rows:2,value:m.description||"",onChange:r=>w("description",r.target.value)})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Ubicación *"}),e.jsx(s.Control,{size:"sm",value:m.ubicacion||"",onChange:r=>w("ubicacion",r.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"WhatsApp"}),e.jsx(s.Control,{size:"sm",value:m.numWhatsapp||"",onChange:r=>w("numWhatsapp",r.target.value)})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Google Maps URL *"}),e.jsx(s.Control,{size:"sm",value:m.googleMapsUrl||"",onChange:r=>w("googleMapsUrl",r.target.value),placeholder:"https://maps.google.com/..."})]}),e.jsx(V,{images:m.imagenes||[],onChange:r=>E(v=>({...v,imagenes:r.map(R=>({imagenUrl:R}))})),maxImages:5,entityType:"hospedaje",entityId:i?.id,pendingFiles:k,onPendingFile:r=>l(v=>[...v,r]),onRemovePendingFile:r=>l(v=>v.filter((R,B)=>B!==r))}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(C,{size:"sm",variant:"primary",onClick:P,disabled:z,children:z?e.jsx(H,{size:"sm"}):t?"Crear":"Guardar"}),!t&&i&&e.jsx(C,{size:"sm",variant:"outline-danger",onClick:()=>g(!0),children:"Eliminar"}),e.jsx(C,{size:"sm",variant:"secondary",onClick:()=>{y(null),x(!1)},children:"Cancelar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un item o crea uno nuevo"})]}),e.jsxs(G,{show:f,onHide:()=>g(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Confirmar"})}),e.jsxs(G.Body,{children:['¿Eliminar "',i?.titulo,'"?']}),e.jsxs(G.Footer,{children:[e.jsx(C,{variant:"secondary",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(C,{variant:"danger",onClick:J,children:"Eliminar"})]})]})]})}const le={titulo:"",descripcion:"",direccion:"",horario:"",telefono:"",latitud:void 0,longitud:void 0,facebook:"",instagram:"",imagenes:[]};function Ne(){const[D,A]=o.useState([]),[F,$]=o.useState(!0),[n,T]=o.useState(null),[i,y]=o.useState(!1),[t,x]=o.useState(le),[m,E]=o.useState(!1),[z,p]=o.useState(null),[I,b]=o.useState(!1),[f,g]=o.useState([]);o.useEffect(()=>{d()},[]);const d=async()=>{try{$(!0);const a=await N.get("/servicio");A(a.data||[])}catch(a){console.error("Error:",a)}finally{$(!1)}},u=a=>{T(a),y(!1),x({...a}),g([])},k=()=>{T(null),y(!0),x({...le}),g([])},l=(a,j)=>{x(w=>({...w,[a]:j}))},L=async()=>{if(!t.titulo){p({tipo:"danger",texto:"Título requerido"});return}E(!0);try{const a=i?"/servicio":`/servicio/${n?.id}`,{id:j,imagenes:w,...M}=t,P={...i?M:{...M,id:t.id},descripcion:t.descripcion?.trim()||void 0,telefono:t.telefono?.trim()||void 0,facebook:t.facebook?.trim()||void 0,instagram:t.instagram?.trim()||void 0,latitud:t.latitud||void 0,longitud:t.longitud||void 0},r=(i?await N.post(a,P):await N.put(a,P)).data,v=i?r.id:n?.id;if(f.length>0&&v){for(const R of f){const B=new FormData;B.append("file",R);try{await N.post(`/servicio/${v}/imagenes`,B,{headers:{"Content-Type":"multipart/form-data"}})}catch(_){console.error("Error subiendo imagen:",_)}}g([])}p({tipo:"success",texto:i?"Creado":"Actualizado"}),d(),i&&(y(!1),x(le))}catch{p({tipo:"danger",texto:"Error de conexión"})}finally{E(!1),setTimeout(()=>p(null),3e3)}},h=async()=>{if(n)try{await N.delete(`/servicio/${n.id}`),p({tipo:"success",texto:"Eliminado"}),T(null),x(le),d()}catch{p({tipo:"danger",texto:"Error al eliminar"})}finally{b(!1),setTimeout(()=>p(null),3e3)}};return F?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(H,{size:"sm"})," Cargando..."]}):e.jsxs(S,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(C,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:k,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Agregar nuevo"})]}),e.jsxs(U,{style:{maxHeight:400,overflowY:"auto"},children:[D.map(a=>e.jsxs(U.Item,{action:!0,active:n?.id===a.id,onClick:()=>u(a),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:a.titulo}),e.jsx("small",{className:"text-muted",children:a.direccion})]},a.id)),D.length===0&&e.jsx(U.Item,{className:"text-muted",children:"Sin registros"})]})]}),e.jsxs(c,{md:8,children:[z&&e.jsx(q,{variant:z.tipo,className:"py-1 small",children:z.texto}),n||i?e.jsxs(s,{children:[e.jsx("h6",{children:i?"Nuevo Servicio":`Editando: ${n?.titulo}`}),!i&&n&&e.jsx(S,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:n.id,disabled:!0})]})})}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Título *"}),e.jsx(s.Control,{size:"sm",value:t.titulo||"",onChange:a=>l("titulo",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Teléfono"}),e.jsx(s.Control,{size:"sm",value:t.telefono||"",onChange:a=>l("telefono",a.target.value)})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Descripción"}),e.jsx(s.Control,{size:"sm",as:"textarea",rows:2,value:t.descripcion||"",onChange:a=>l("descripcion",a.target.value)})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Dirección"}),e.jsx(s.Control,{size:"sm",value:t.direccion||"",onChange:a=>l("direccion",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Horario"}),e.jsx(s.Control,{size:"sm",value:t.horario||"",onChange:a=>l("horario",a.target.value)})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Latitud"}),e.jsx(s.Control,{size:"sm",type:"number",step:"any",value:t.latitud??"",onChange:a=>l("latitud",parseFloat(a.target.value)||0)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Longitud"}),e.jsx(s.Control,{size:"sm",type:"number",step:"any",value:t.longitud??"",onChange:a=>l("longitud",parseFloat(a.target.value)||0)})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Facebook"}),e.jsx(s.Control,{size:"sm",value:t.facebook||"",onChange:a=>l("facebook",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Instagram"}),e.jsx(s.Control,{size:"sm",value:t.instagram||"",onChange:a=>l("instagram",a.target.value)})]})})]}),e.jsx(V,{images:t.imagenes||[],onChange:a=>x(j=>({...j,imagenes:a.map(w=>({imagenUrl:w}))})),maxImages:5,entityType:"servicio",entityId:n?.id,pendingFiles:f,onPendingFile:a=>g(j=>[...j,a]),onRemovePendingFile:a=>g(j=>j.filter((w,M)=>M!==a))}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(C,{size:"sm",variant:"primary",onClick:L,disabled:m,children:m?e.jsx(H,{size:"sm"}):i?"Crear":"Guardar"}),!i&&n&&e.jsx(C,{size:"sm",variant:"outline-danger",onClick:()=>b(!0),children:"Eliminar"}),e.jsx(C,{size:"sm",variant:"secondary",onClick:()=>{T(null),y(!1)},children:"Cancelar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un item o crea uno nuevo"})]}),e.jsxs(G,{show:I,onHide:()=>b(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Confirmar"})}),e.jsxs(G.Body,{children:['¿Eliminar "',n?.titulo,'"?']}),e.jsxs(G.Footer,{children:[e.jsx(C,{variant:"secondary",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(C,{variant:"danger",onClick:h,children:"Eliminar"})]})]})]})}const de={titulo:"",description:"",direccion:"",horario:"",telefono:"",latitud:void 0,longitud:void 0,facebook:"",instagram:"",imagenes:[]};function Ce(){const[D,A]=o.useState([]),[F,$]=o.useState(!0),[n,T]=o.useState(null),[i,y]=o.useState(!1),[t,x]=o.useState(de),[m,E]=o.useState(!1),[z,p]=o.useState(null),[I,b]=o.useState([]);o.useEffect(()=>{f()},[]);const f=async()=>{try{$(!0);const l=await N.get("/terma");console.log("Termas cargadas:",l.data),A(l.data||[])}catch(l){console.error("Error:",l),A([])}finally{$(!1)}},g=l=>{T(l),y(!1),x({...l}),b([])},d=()=>{T(null),y(!0),x({...de}),b([])},u=(l,L)=>{x(h=>({...h,[l]:L}))},k=async()=>{if(!t.titulo){p({tipo:"danger",texto:"Título requerido"});return}E(!0);try{const l=i?"/terma":`/terma/${n?.id}`,{id:L,description:h,...a}=t,j={...i?a:{...t,description:void 0},descripcion:t.description?.trim()||void 0,direccion:t.direccion?.trim()||void 0,horario:t.horario?.trim()||void 0,telefono:t.telefono?.trim()||void 0,latitud:t.latitud||void 0,longitud:t.longitud||void 0,facebook:t.facebook?.trim()||void 0,instagram:t.instagram?.trim()||void 0},M=(i?await N.post(l,j):await N.patch(l,j)).data,P=i?M.id:n?.id;if(I.length>0&&P){for(const J of I){const r=new FormData;r.append("file",J);try{await N.post(`/terma/${P}/imagenes`,r,{headers:{"Content-Type":"multipart/form-data"}})}catch(v){console.error("Error subiendo imagen:",v)}}b([])}p({tipo:"success",texto:i?"Creado":"Actualizado"}),f(),i&&(y(!1),x(de))}catch(l){console.error("Error en handleSave:",l);const L=l.response?.data||{};p({tipo:"danger",texto:L.message||L.error||"Error de conexión"})}finally{E(!1),setTimeout(()=>p(null),3e3)}};return F?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(H,{size:"sm"})," Cargando..."]}):e.jsxs(S,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(C,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:d,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Crear primera terma"})]}),e.jsxs(U,{style:{maxHeight:400,overflowY:"auto"},children:[D.map(l=>e.jsxs(U.Item,{action:!0,active:n?.id===l.id,onClick:()=>g(l),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:l.titulo}),e.jsx("small",{className:"text-muted",children:l.direccion})]},l.id)),D.length===0&&e.jsx(U.Item,{className:"text-muted",children:"Sin registros - crea la primera"})]})]}),e.jsxs(c,{md:8,children:[z&&e.jsx(q,{variant:z.tipo,className:"py-1 small",children:z.texto}),n||i?e.jsxs(s,{children:[e.jsx("h6",{children:i?"Nueva Terma":`Editando: ${n?.titulo}`}),!i&&n&&e.jsx(S,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:n.id,disabled:!0})]})})}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Título *"}),e.jsx(s.Control,{size:"sm",value:t.titulo||"",onChange:l=>u("titulo",l.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Teléfono"}),e.jsx(s.Control,{size:"sm",value:t.telefono||"",onChange:l=>u("telefono",l.target.value)})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Descripción"}),e.jsx(s.Control,{size:"sm",as:"textarea",rows:2,value:t.description||"",onChange:l=>u("description",l.target.value)})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Dirección"}),e.jsx(s.Control,{size:"sm",value:t.direccion||"",onChange:l=>u("direccion",l.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Horario"}),e.jsx(s.Control,{size:"sm",value:t.horario||"",onChange:l=>u("horario",l.target.value)})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Latitud"}),e.jsx(s.Control,{size:"sm",type:"number",step:"any",value:t.latitud??"",onChange:l=>u("latitud",parseFloat(l.target.value)||0)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Longitud"}),e.jsx(s.Control,{size:"sm",type:"number",step:"any",value:t.longitud??"",onChange:l=>u("longitud",parseFloat(l.target.value)||0)})]})})]}),e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Facebook"}),e.jsx(s.Control,{size:"sm",value:t.facebook||"",onChange:l=>u("facebook",l.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Instagram"}),e.jsx(s.Control,{size:"sm",value:t.instagram||"",onChange:l=>u("instagram",l.target.value)})]})})]}),e.jsx(V,{images:t.imagenes||[],onChange:l=>x(L=>({...L,imagenes:l.map(h=>({imagenUrl:h}))})),maxImages:5,entityType:"terma",entityId:n?.id,pendingFiles:I,onPendingFile:l=>b(L=>[...L,l]),onRemovePendingFile:l=>b(L=>L.filter((h,a)=>a!==l))}),n?.imagenes&&n.imagenes.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-1",children:"Imágenes"}),e.jsx("div",{className:"d-flex gap-1 flex-wrap",children:n.imagenes.map((l,L)=>e.jsx("img",{src:l.imagenUrl,alt:"",style:{width:60,height:60,objectFit:"cover"}},L))})]}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(C,{size:"sm",variant:"primary",onClick:k,disabled:m,children:m?e.jsx(H,{size:"sm"}):i?"Crear":"Guardar"}),e.jsx(C,{size:"sm",variant:"secondary",onClick:()=>{T(null),y(!1)},children:"Cancelar"}),!i&&n&&e.jsx(C,{size:"sm",variant:"danger",onClick:async()=>{if(window.confirm("¿Estás seguro de eliminar esta terma?")){try{await N.delete(`/terma/${n.id}`),p({tipo:"success",texto:"Terma eliminada"}),T(null),f()}catch{p({tipo:"danger",texto:"Error al eliminar"})}setTimeout(()=>p(null),3e3)}},children:"Eliminar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona la terma para editar o crea una nueva"})]})]})}const ue={firstName:"",lastName:"",email:"",password:"",role:"USER"};function ye(){const[D,A]=o.useState([]),[F,$]=o.useState(!0),[n,T]=o.useState(null),[i,y]=o.useState(null),[t,x]=o.useState(!1),[m,E]=o.useState(!1),[z,p]=o.useState(""),[I,b]=o.useState(ue),[f,g]=o.useState(!1);o.useEffect(()=>{d()},[]);const d=async()=>{try{$(!0);const h=await fetch("/api/user/all",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(h.ok){const a=await h.json();A(a)}else console.warn("API respondió con error:",h.status),A([])}catch(h){console.error("Error cargando usuarios:",h),A([])}finally{$(!1)}},u=h=>{T(h)},k=async()=>{if(!(!n||!z)){g(!0);try{const h=localStorage.getItem("token"),a=await fetch(`/api/user/${n.id}/role`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({role:z})});if(a.ok)y({tipo:"success",texto:"Rol actualizado"}),d(),x(!1);else{const j=await a.json().catch(()=>({}));y({tipo:"danger",texto:j.error||j.detalle||"Error al cambiar rol"})}}catch(h){console.error("Error:",h),y({tipo:"danger",texto:"Error de conexión"})}finally{g(!1),setTimeout(()=>y(null),3e3)}}},l=async()=>{if(!I.firstName||!I.email||!I.password){y({tipo:"danger",texto:"Nombre, email y contraseña son requeridos"});return}g(!0);try{const h=localStorage.getItem("token"),a={correo:I.email,nombre:I.firstName,contrasenia:I.password,role:I.role},j=await fetch("/api/user/moderador/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(a)});if(j.ok)y({tipo:"success",texto:"Usuario creado correctamente"}),E(!1),b(ue),d();else{const w=await j.json().catch(()=>({}));y({tipo:"danger",texto:w.error||w.detalle||"Error al crear usuario"})}}catch(h){console.error("Error:",h),y({tipo:"danger",texto:"Error de conexión"})}finally{g(!1),setTimeout(()=>y(null),3e3)}},L=h=>{switch(h){case"MODERADOR":return e.jsx(Y,{bg:"danger",children:"Moderador"});case"ADMINISTRADOR":return e.jsx(Y,{bg:"warning",text:"dark",children:"Administrador"});case"USER":return e.jsx(Y,{bg:"secondary",children:"Usuario"});default:return e.jsx(Y,{bg:"light",text:"dark",children:h})}};return F?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(H,{size:"sm"})," Cargando..."]}):e.jsxs(S,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("small",{className:"text-muted",children:[D.length," usuario(s)"]}),e.jsx(C,{variant:"success",size:"sm",onClick:()=>E(!0),children:"+ Nuevo"})]}),e.jsxs(U,{style:{maxHeight:400,overflowY:"auto"},children:[D.map(h=>e.jsx(U.Item,{action:!0,active:n?.id===h.id,onClick:()=>u(h),className:"py-2",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"fw-bold small",children:[h.firstName," ",h.lastName]}),e.jsx("small",{className:"text-muted",children:h.email})]}),L(h.role)]})},h.id)),D.length===0&&e.jsx(U.Item,{className:"text-muted",children:"Sin usuarios registrados"})]})]}),e.jsxs(c,{md:8,children:[i&&e.jsx(q,{variant:i.tipo,className:"py-1 small",children:i.texto}),n?e.jsxs("div",{children:[e.jsx("h6",{children:"Detalles del Usuario"}),e.jsx("table",{className:"table table-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-muted",style:{width:"30%"},children:"Nombre"}),e.jsxs("td",{children:[n.firstName," ",n.lastName]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-muted",children:"Email"}),e.jsxs("td",{children:[n.email,n.emailVerified?e.jsx(Y,{bg:"success",className:"ms-2",children:"Verificado"}):e.jsx(Y,{bg:"warning",text:"dark",className:"ms-2",children:"No verificado"})]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-muted",children:"Rol"}),e.jsx("td",{children:L(n.role)})]}),n.address&&e.jsxs("tr",{children:[e.jsx("th",{className:"text-muted",children:"Dirección"}),e.jsx("td",{children:n.address})]})]})}),e.jsx(C,{size:"sm",variant:"outline-primary",onClick:()=>{p(n.role),x(!0)},children:"Cambiar Rol"})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un usuario para ver detalles"})]}),e.jsxs(G,{show:t,onHide:()=>x(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Cambiar Rol"})}),e.jsxs(G.Body,{children:[e.jsxs("p",{children:["Cambiar rol de ",e.jsxs("strong",{children:[n?.firstName," ",n?.lastName]})]}),e.jsxs(s.Select,{value:z,onChange:h=>p(h.target.value),children:[e.jsx("option",{value:"USER",children:"Usuario"}),e.jsx("option",{value:"ADMINISTRADOR",children:"Administrador"}),e.jsx("option",{value:"MODERADOR",children:"Moderador"})]}),e.jsxs("small",{className:"text-muted mt-2 d-block",children:[e.jsx("strong",{children:"Usuario:"})," Acceso básico.",e.jsx("br",{}),e.jsx("strong",{children:"Administrador:"})," Gestiona comercios/negocios asignados.",e.jsx("br",{}),e.jsx("strong",{children:"Moderador:"})," Acceso total al panel de moderación."]})]}),e.jsxs(G.Footer,{children:[e.jsx(C,{variant:"secondary",onClick:()=>x(!1),children:"Cancelar"}),e.jsx(C,{variant:"primary",onClick:k,disabled:f,children:f?e.jsx(H,{size:"sm"}):"Guardar"})]})]}),e.jsxs(G,{show:m,onHide:()=>E(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Crear Usuario"})}),e.jsx(G.Body,{children:e.jsxs(s,{children:[e.jsxs(S,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Nombre *"}),e.jsx(s.Control,{size:"sm",value:I.firstName,onChange:h=>b({...I,firstName:h.target.value})})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Apellido"}),e.jsx(s.Control,{size:"sm",value:I.lastName,onChange:h=>b({...I,lastName:h.target.value})})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Email *"}),e.jsx(s.Control,{size:"sm",type:"email",value:I.email,onChange:h=>b({...I,email:h.target.value})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Contraseña *"}),e.jsx(s.Control,{size:"sm",type:"password",value:I.password,onChange:h=>b({...I,password:h.target.value})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Rol"}),e.jsxs(s.Select,{size:"sm",value:I.role,onChange:h=>b({...I,role:h.target.value}),children:[e.jsx("option",{value:"USER",children:"Usuario"}),e.jsx("option",{value:"ADMINISTRADOR",children:"Administrador"}),e.jsx("option",{value:"MODERADOR",children:"Moderador"})]})]})]})}),e.jsxs(G.Footer,{children:[e.jsx(C,{variant:"secondary",onClick:()=>E(!1),children:"Cancelar"}),e.jsx(C,{variant:"primary",onClick:l,disabled:f,children:f?e.jsx(H,{size:"sm"}):"Crear"})]})]})]})}const Se=[{key:"config-home",titulo:"Imágenes del Home",componente:e.jsx(je,{})},{key:"usuarios",titulo:"Usuarios",componente:e.jsx(ye,{})},{key:"comercios",titulo:"Comercios",componente:e.jsx(ge,{})},{key:"servicios",titulo:"Servicios",componente:e.jsx(Ne,{})},{key:"eventos",titulo:"Eventos",componente:e.jsx(ve,{})},{key:"espacios",titulo:"Espacios Públicos",componente:e.jsx(pe,{})},{key:"hospedajes",titulo:"Hospedajes",componente:e.jsx(fe,{})},{key:"gastronomia",titulo:"Gastronomía",componente:e.jsx(be,{})},{key:"termas",titulo:"Termas",componente:e.jsx(Ce,{})}];function De(){const[D,A]=o.useState("usuarios");return e.jsxs(he,{fluid:!0,className:"py-3",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"mb-1",children:"Panel de Moderador"}),e.jsx(Y,{bg:"secondary",children:"Gestión de contenido público"})]}),e.jsx(Z,{activeKey:D,onSelect:F=>A(F),children:Se.map(F=>e.jsxs(Z.Item,{eventKey:F.key,children:[e.jsx(Z.Header,{children:F.titulo}),e.jsx(Z.Body,{children:F.componente})]},F.key))})]})}export{De as default};
