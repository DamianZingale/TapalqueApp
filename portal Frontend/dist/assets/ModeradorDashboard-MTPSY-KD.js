import{r as o,j as e,F as s,f as y,g as c,s as me,h as N,i as q,S as P,L as H,M as G,l as oe,B as Y,C as he,A as Z}from"./bootstrap-Xw_QKhRw.js";import{a as b,B as xe,b as ge}from"./index-BNk7istX.js";import"./vendor-CjZsb-BP.js";import"./router-BWUcrwnu.js";import"./utils-ovYNnex0.js";function V({images:k,onChange:T,maxImages:A=5,entityType:F="comercio",entityId:n,onPendingFile:L,pendingFiles:i=[],onRemovePendingFile:z}){const[t,u]=o.useState(""),[d,w]=o.useState(!1),I=Array.isArray(k)?k.map(x=>typeof x=="string"?x:x.imagenUrl):[],v=()=>{if(t.trim()&&I.length<A){const x=[...I,t.trim()];T(x),u("")}},$=async x=>{const j=x.target.files;if(!j||j.length===0||I.length+i.length>=A)return;const m=j[0];if(!m.type.match(/image\/(jpeg|jpg|png)/)){alert("Solo se permiten archivos JPEG, JPG o PNG");return}if(m.size>5*1024*1024){alert("El archivo no puede superar los 5MB");return}w(!0);try{const h=new FormData;if(h.append("imagen",m),n&&F){let E="";E={comercio:`/api/comercio/imagen/${n}`,hospedaje:`/api/hospedajes/${n}/imagenes`,gastronomia:`/api/restaurante/${n}/imagenes`,terma:`/api/terma/${n}/imagenes`,servicio:`/api/servicio/${n}/imagenes`,evento:`/api/evento/${n}/imagenes`,"espacio-publico":`/api/espacio-publico/${n}/imagenes`}[F]||`/api/comercio/imagen/${n}`,h.delete("imagen"),h.append("file",m),console.log("Subiendo imagen a:",E);const D=await fetch(E,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:h});if(D.ok){const R=await D.json();console.log("Imagen subida exitosamente:",R);const a=R.imagenUrl||R.url||R.message;if(a){const f=[...I,a];T(f)}else alert("La imagen se subió pero no se recibió la URL")}else{console.error("Error en respuesta del servidor:",D.status);const R=await D.json().catch(()=>({}));alert(`Error al subir imagen: ${R.message||R.error||`Error ${D.status}`}`)}}else L?L(m):alert("Debe guardar el registro primero antes de subir imágenes")}catch(h){console.error("Error subiendo imagen:",h),alert("Error de conexión al subir la imagen. Verifique que el backend esté disponible.")}finally{w(!1),x.target.value=""}},C=async x=>{const j=I[x];if(n&&F)try{const E={comercio:`/api/comercio/imagen/${n}`,hospedaje:`/api/hospedajes/${n}/imagenes`,gastronomia:`/api/restaurante/${n}/imagenes`,terma:`/api/terma/${n}/imagenes`,servicio:`/api/servicio/${n}/imagenes`,evento:`/api/evento/${n}/imagenes`,"espacio-publico":`/api/espacio-publico/${n}/imagenes`}[F]||`/api/comercio/imagen/${n}`,r=await fetch(E,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({imagenUrl:j})});r.ok||console.warn("No se pudo eliminar la imagen del servidor:",r.status)}catch(h){console.error("Error eliminando imagen del backend:",h)}const m=I.filter((h,E)=>E!==x);T(m)};return e.jsxs("div",{className:"mb-3",children:[e.jsxs(s.Label,{className:"small mb-2",children:["Imágenes (",I.length+i.length,"/",A,")"]}),I.length>0&&e.jsx(y,{className:"mb-3 g-2",children:I.map((x,j)=>e.jsx(c,{xs:6,md:4,lg:3,children:e.jsxs("div",{className:"position-relative",children:[e.jsx(me,{src:x,alt:`Imagen ${j+1}`,fluid:!0,className:"w-100 h-100",style:{objectFit:"cover",maxHeight:"120px"},onError:m=>{console.warn("Error cargando imagen:",x),m.currentTarget.src="https://via.placeholder.com/120x120/cccccc/666666?text=Error"},onLoad:()=>{console.log("Imagen cargada exitosamente:",x)}}),e.jsx(N,{variant:"danger",size:"sm",className:"position-absolute top-0 end-0 m-1",onClick:()=>C(j),style:{fontSize:"0.7rem",padding:"0.2rem 0.4rem"},children:"×"})]})},j))}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(s.Label,{className:"small mb-2 text-warning",children:["Archivos pendientes (",i.length,") - Se subirán al guardar"]}),e.jsx(y,{className:"mb-3 g-2",children:i.map((x,j)=>e.jsx(c,{xs:6,md:4,lg:3,children:e.jsxs("div",{className:"position-relative border border-warning rounded p-1",children:[e.jsx(me,{src:URL.createObjectURL(x),alt:`Pendiente ${j+1}`,fluid:!0,className:"w-100 h-100",style:{objectFit:"cover",maxHeight:"120px"}}),z&&e.jsx(N,{variant:"warning",size:"sm",className:"position-absolute top-0 end-0 m-1",onClick:()=>z(j),style:{fontSize:"0.7rem",padding:"0.2rem 0.4rem"},children:"×"}),e.jsx("small",{className:"d-block text-center text-muted text-truncate",style:{fontSize:"0.65rem"},children:x.name})]})},`pending-${j}`))})]}),I.length+i.length<A&&e.jsxs(y,{className:"g-2",children:[e.jsx(c,{md:6,children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(s.Control,{size:"sm",type:"url",placeholder:"https://ejemplo.com/imagen.jpg",value:t,onChange:x=>u(x.target.value),onKeyPress:x=>x.key==="Enter"&&v()}),e.jsx(N,{size:"sm",variant:"outline-primary",onClick:v,children:"Agregar URL"})]})}),e.jsxs(c,{md:6,children:[e.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[e.jsx(s.Control,{type:"file",size:"sm",accept:".jpg,.jpeg,.png",onChange:$,disabled:d}),d&&e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Subiendo..."})})]}),e.jsx("small",{className:"text-muted",children:"JPEG, JPG, PNG (máx. 5MB)"})]})]}),I.length+i.length>=A&&e.jsxs(q,{variant:"info",className:"py-2 small",children:["Máximo de ",A," imágenes alcanzado"]})]})}const je={getComercios:()=>b.get("/comercio/list"),getComercioById:k=>b.get(`/comercio/${k}`),createComercio:k=>b.post("/comercio",k),updateComercio:(k,T)=>b.put(`/comercio/${k}`,T),deleteComercio:k=>b.delete(`/comercio/${k}`),getAdministradores:()=>b.get("/user/administradores")},ee={titulo:"",descripcion:"",direccion:"",horario:"",telefono:"",latitud:void 0,longitud:void 0,facebook:"",instagram:"",tag:"",imagenes:[]};function pe(){const[k,T]=o.useState([]),[A,F]=o.useState(!0),[n,L]=o.useState(null),[i,z]=o.useState(!1),[t,u]=o.useState(ee),[d,w]=o.useState(!1),[I,v]=o.useState(null),[$,C]=o.useState(!1),[x,j]=o.useState([]);o.useEffect(()=>{m()},[]);const m=async()=>{try{F(!0);const a=await je.getComercios();T(a.data),console.log("Datos cargados desde API:",a.data)}catch(a){console.error("Error cargando datos:",a),T([])}finally{F(!1)}},h=a=>{console.log("Item seleccionado:",a),L(a),z(!1),u({...a}),j([])},E=()=>{L(null),z(!0),u({...ee}),j([])},r=(a,f)=>{u(S=>({...S,[a]:f}))},D=async()=>{if(!t.titulo){v({tipo:"danger",texto:"Título requerido"});return}w(!0);try{const a=i?"/comercio":`/comercio/${n?.id}`,{id:f,imagenes:S,...M}=t,g={...i?M:{...M,id:t.id},descripcion:t.descripcion?.trim()||"",telefono:t.telefono?.trim()||void 0,facebook:t.facebook?.trim()||void 0,instagram:t.instagram?.trim()||void 0,latitud:t.latitud!=null&&String(t.latitud).trim()!==""?parseFloat(String(t.latitud)):void 0,longitud:t.longitud!=null&&String(t.longitud).trim()!==""?parseFloat(String(t.longitud)):void 0,tag:t.tag?.trim().toUpperCase()||void 0};console.log("Enviando datos:",g),console.log("URL:",a);const B=i?await b.post(a,g):await b.patch(a,g);console.log("Respuesta:",B.data);const l=B.data,p=i?l.id:n?.id;if(x.length>0&&p){for(const U of x){const O=new FormData;O.append("file",U);try{await b.post(`/comercio/imagen/${p}`,O,{headers:{"Content-Type":"multipart/form-data"}})}catch(W){console.error("Error subiendo imagen:",W)}}j([])}v({tipo:"success",texto:i?"Creado":"Actualizado"}),m(),i&&(z(!1),u(ee))}catch(a){console.error("Error en handleSave:",a);const f=a.response?.data||{};v({tipo:"danger",texto:f.message||f.error||"Error de conexión"})}finally{w(!1),setTimeout(()=>v(null),3e3)}},R=async()=>{if(n)try{await b.delete(`/comercio/${n.id}`),v({tipo:"success",texto:"Eliminado"}),L(null),u(ee),m()}catch(a){console.error("Error en handleDelete:",a);const f=a.response?.data||{};v({tipo:"danger",texto:f.message||f.error||"Error al eliminar"})}finally{C(!1),setTimeout(()=>v(null),3e3)}};return A?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(P,{size:"sm"})," Cargando..."]}):e.jsxs(y,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(N,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:E,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Agregar nuevo"})]}),e.jsxs(H,{style:{maxHeight:400,overflowY:"auto"},children:[k.map(a=>e.jsxs(H.Item,{action:!0,active:n?.id===a.id,onClick:()=>h(a),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:a.titulo}),e.jsx("small",{className:"text-muted",children:a.direccion})]},a.id)),k.length===0&&e.jsx(H.Item,{className:"text-muted",children:"Sin registros"})]})]}),e.jsxs(c,{md:8,children:[I&&e.jsx(q,{variant:I.tipo,className:"py-1 small",children:I.texto}),n||i?e.jsxs(s,{children:[e.jsx("h6",{children:i?"Nuevo Comercio":`Editando: ${n?.titulo}`}),!i&&n&&e.jsx(y,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:n.id,disabled:!0})]})})}),e.jsxs(y,{children:[e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Título *"}),e.jsx(s.Control,{size:"sm",value:t.titulo||"",onChange:a=>r("titulo",a.target.value)})]})}),e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Tag"}),e.jsx(s.Control,{size:"sm",placeholder:"Ej: REMIS",value:t.tag||"",onChange:a=>r("tag",a.target.value.toUpperCase())})]})}),e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Teléfono"}),e.jsx(s.Control,{size:"sm",value:t.telefono||"",onChange:a=>r("telefono",a.target.value)})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Descripción"}),e.jsx(s.Control,{size:"sm",as:"textarea",rows:2,value:t.descripcion||"",onChange:a=>r("descripcion",a.target.value)})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Dirección"}),e.jsx(s.Control,{size:"sm",value:t.direccion||"",onChange:a=>r("direccion",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Horario"}),e.jsx(s.Control,{size:"sm",value:t.horario||"",onChange:a=>r("horario",a.target.value)})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Latitud"}),e.jsx(s.Control,{size:"sm",value:t.latitud??"",onChange:a=>r("latitud",a.target.value),placeholder:"Ej: -36.345099"})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Longitud"}),e.jsx(s.Control,{size:"sm",value:t.longitud??"",onChange:a=>r("longitud",a.target.value),placeholder:"Ej: -60.006261"})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Facebook"}),e.jsx(s.Control,{size:"sm",value:t.facebook||"",onChange:a=>r("facebook",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Instagram"}),e.jsx(s.Control,{size:"sm",value:t.instagram||"",onChange:a=>r("instagram",a.target.value)})]})})]}),e.jsx(V,{images:t.imagenes||[],onChange:a=>u(f=>({...f,imagenes:a.map(S=>({imagenUrl:S}))})),maxImages:5,entityType:"comercio",entityId:n?.id,pendingFiles:x,onPendingFile:a=>j(f=>[...f,a]),onRemovePendingFile:a=>j(f=>f.filter((S,M)=>M!==a))}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(N,{size:"sm",variant:"primary",onClick:D,disabled:d,children:d?e.jsx(P,{size:"sm"}):i?"Crear":"Guardar"}),!i&&n&&e.jsx(N,{size:"sm",variant:"outline-danger",onClick:()=>C(!0),children:"Eliminar"}),e.jsx(N,{size:"sm",variant:"secondary",onClick:()=>{L(null),z(!1)},children:"Cancelar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un item o crea uno nuevo"})]}),e.jsxs(G,{show:$,onHide:()=>C(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Confirmar eliminación"})}),e.jsxs(G.Body,{children:['¿Eliminar "',n?.titulo,'"?']}),e.jsxs(G.Footer,{children:[e.jsx(N,{variant:"secondary",onClick:()=>C(!1),children:"Cancelar"}),e.jsx(N,{variant:"danger",onClick:R,children:"Eliminar"})]})]})]})}const ce={COMERCIO:"Comercios",GASTRONOMIA:"Gastronomía",HOSPEDAJE:"Hospedajes",SERVICIOS:"Servicios",ESPACIOS:"Espacios Públicos",EVENTOS:"Eventos",TERMAS:"Termas"};function ve(){const[k,T]=o.useState([]),[A,F]=o.useState(!0),[n,L]=o.useState(null),[i,z]=o.useState(null),[t,u]=o.useState(null),[d,w]=o.useState({}),I=o.useRef({});o.useEffect(()=>{v()},[]);const v=async()=>{try{F(!0);const h=(await b.get("/home-config")).data||[];T(h);const E={};h.forEach(r=>{E[r.seccion]=r.imagenUrl||""}),w(E)}catch(m){console.error("Error cargando configuración del home:",m),T([])}finally{F(!1)}},$=(m,h)=>{w(E=>({...E,[m]:h}))},C=async m=>{L(m);try{await b.put(`/home-config/seccion/${m}`,{imagenUrl:d[m]||null}),u({tipo:"success",texto:`Imagen de ${ce[m]} actualizada`}),v()}catch(h){console.error("Error guardando:",h),u({tipo:"danger",texto:h.response?.data?.message||"Error al guardar"})}finally{L(null),setTimeout(()=>u(null),3e3)}},x=m=>{I.current[m]?.click()},j=async(m,h)=>{if(h){if(!h.type.startsWith("image/")){u({tipo:"danger",texto:"El archivo debe ser una imagen"}),setTimeout(()=>u(null),3e3);return}if(h.size>5*1024*1024){u({tipo:"danger",texto:"La imagen no debe superar 5MB"}),setTimeout(()=>u(null),3e3);return}z(m);try{const E=new FormData;E.append("file",h);const r=await b.post(`/home-config/seccion/${m}/imagen`,E,{headers:{"Content-Type":"multipart/form-data"}});u({tipo:"success",texto:`Imagen de ${ce[m]} subida correctamente`}),r.data?.imagenUrl&&w(D=>({...D,[m]:r.data.imagenUrl})),v()}catch(E){console.error("Error subiendo imagen:",E),u({tipo:"danger",texto:E.response?.data?.error||"Error al subir imagen"})}finally{z(null),setTimeout(()=>u(null),3e3)}}};return A?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(P,{size:"sm"})," Cargando configuración..."]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-muted small mb-3",children:"Configura las imágenes de fondo para cada sección del Home. Puedes subir una imagen o pegar una URL externa."}),t&&e.jsx(q,{variant:t.tipo,className:"py-2 small",children:t.texto}),e.jsx(y,{className:"g-3",children:k.map(m=>e.jsx(c,{md:6,lg:4,children:e.jsxs(oe,{className:"h-100",children:[e.jsx(oe.Header,{className:"py-2",children:e.jsx("strong",{className:"small",children:ce[m.seccion]||m.seccion})}),e.jsxs(oe.Body,{className:"p-2",children:[e.jsx("div",{className:"mb-2 rounded position-relative",style:{height:"100px",backgroundImage:d[m.seccion]?`url(${d[m.seccion]})`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundSize:"cover",backgroundPosition:"center",border:"1px solid #dee2e6"},children:i===m.seccion&&e.jsx("div",{className:"position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx(P,{size:"sm",variant:"light"})})}),e.jsx("input",{type:"file",accept:"image/*",ref:h=>{I.current[m.seccion]=h},style:{display:"none"},onChange:h=>{const E=h.target.files?.[0];E&&j(m.seccion,E),h.target.value=""}}),e.jsx(N,{size:"sm",variant:"outline-primary",className:"w-100 mb-2",onClick:()=>x(m.seccion),disabled:i===m.seccion||n===m.seccion,children:i===m.seccion?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"sm",className:"me-1"})," Subiendo..."]}):"Subir imagen"}),e.jsx("div",{className:"text-center small text-muted mb-2",children:"- o usar URL -"}),e.jsx(s.Group,{className:"mb-2",children:e.jsx(s.Control,{size:"sm",type:"url",placeholder:"https://ejemplo.com/imagen.jpg",value:d[m.seccion]||"",onChange:h=>$(m.seccion,h.target.value)})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(N,{size:"sm",variant:"primary",onClick:()=>C(m.seccion),disabled:n===m.seccion||i===m.seccion,className:"flex-grow-1",children:n===m.seccion?e.jsx(P,{size:"sm"}):"Guardar URL"}),e.jsx(N,{size:"sm",variant:"outline-secondary",onClick:()=>$(m.seccion,m.imagenUrl||""),disabled:n===m.seccion||i===m.seccion,children:"Restaurar"})]}),m.updatedAt&&e.jsxs("small",{className:"text-muted d-block mt-2",children:["Actualizado: ",new Date(m.updatedAt).toLocaleDateString()]})]})]})},m.seccion))}),k.length===0&&e.jsx(q,{variant:"info",className:"mt-3",children:"No hay configuraciones. Se crearán automáticamente al iniciar el backend."})]})}const se={titulo:"",descripcion:"",direccion:"",telefono:"",latitud:void 0,longitud:void 0,facebook:"",instagram:"",twitter:"",tiktok:"",categoria:"",horario:"",imagenes:[]};function be(){const[k,T]=o.useState([]),[A,F]=o.useState(!0),[n,L]=o.useState(null),[i,z]=o.useState(!1),[t,u]=o.useState(se),[d,w]=o.useState(!1),[I,v]=o.useState(null),[$,C]=o.useState(!1),[x,j]=o.useState([]);o.useEffect(()=>{m()},[]);const m=async()=>{try{F(!0);const a=await b.get("/espacio-publico");T(a.data||[])}catch(a){console.error("Error:",a)}finally{F(!1)}},h=a=>{L(a),z(!1),u({...a}),j([])},E=()=>{L(null),z(!0),u({...se}),j([])},r=(a,f)=>{u(S=>({...S,[a]:f}))},D=async()=>{if(!t.titulo){v({tipo:"danger",texto:"Título requerido"});return}w(!0);try{const a=i?"/espacio-publico":`/espacio-publico/${n?.id}`,{id:f,imagenes:S,...M}=t,g={...i?M:{...M,id:t.id},descripcion:t.descripcion?.trim()||void 0,telefono:t.telefono?.trim()||void 0,facebook:t.facebook?.trim()||void 0,instagram:t.instagram?.trim()||void 0,twitter:t.twitter?.trim()||void 0,tiktok:t.tiktok?.trim()||void 0,categoria:t.categoria?.trim()||void 0,horario:t.horario?.trim()||void 0,latitud:t.latitud!=null&&String(t.latitud).trim()!==""?parseFloat(String(t.latitud)):void 0,longitud:t.longitud!=null&&String(t.longitud).trim()!==""?parseFloat(String(t.longitud)):void 0},l=(i?await b.post(a,g):await b.put(a,g)).data,p=i?l.id:n?.id;if(x.length>0&&p){for(const U of x){const O=new FormData;O.append("file",U);try{await b.post(`/espacio-publico/${p}/imagenes`,O,{headers:{"Content-Type":"multipart/form-data"}})}catch(W){console.error("Error subiendo imagen:",W)}}j([])}v({tipo:"success",texto:i?"Creado":"Actualizado"}),m(),i&&(z(!1),u(se))}catch{v({tipo:"danger",texto:"Error de conexión"})}finally{w(!1),setTimeout(()=>v(null),3e3)}},R=async()=>{if(n)try{await b.delete(`/espacio-publico/${n.id}`),v({tipo:"success",texto:"Eliminado"}),L(null),u(se),m()}catch{v({tipo:"danger",texto:"Error al eliminar"})}finally{C(!1),setTimeout(()=>v(null),3e3)}};return A?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(P,{size:"sm"})," Cargando..."]}):e.jsxs(y,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(N,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:E,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Agregar nuevo"})]}),e.jsxs(H,{style:{maxHeight:400,overflowY:"auto"},children:[k.map(a=>e.jsxs(H.Item,{action:!0,active:n?.id===a.id,onClick:()=>h(a),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:a.titulo}),e.jsx("small",{className:"text-muted",children:a.categoria||a.direccion})]},a.id)),k.length===0&&e.jsx(H.Item,{className:"text-muted",children:"Sin registros"})]})]}),e.jsxs(c,{md:8,children:[I&&e.jsx(q,{variant:I.tipo,className:"py-1 small",children:I.texto}),n||i?e.jsxs(s,{children:[e.jsx("h6",{children:i?"Nuevo Espacio Público":`Editando: ${n?.titulo}`}),!i&&n&&e.jsx(y,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:n.id,disabled:!0})]})})}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Título *"}),e.jsx(s.Control,{size:"sm",value:t.titulo||"",onChange:a=>r("titulo",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Categoría"}),e.jsx(s.Control,{size:"sm",value:t.categoria||"",onChange:a=>r("categoria",a.target.value)})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Descripción"}),e.jsx(s.Control,{size:"sm",as:"textarea",rows:2,value:t.descripcion||"",onChange:a=>r("descripcion",a.target.value)})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Dirección"}),e.jsx(s.Control,{size:"sm",value:t.direccion||"",onChange:a=>r("direccion",a.target.value)})]})}),e.jsx(c,{md:3,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Teléfono"}),e.jsx(s.Control,{size:"sm",value:t.telefono||"",onChange:a=>r("telefono",a.target.value)})]})}),e.jsx(c,{md:3,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Horario"}),e.jsx(s.Control,{size:"sm",value:t.horario||"",onChange:a=>r("horario",a.target.value)})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Latitud"}),e.jsx(s.Control,{size:"sm",value:t.latitud??"",onChange:a=>r("latitud",a.target.value),placeholder:"Ej: -36.345099"})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Longitud"}),e.jsx(s.Control,{size:"sm",value:t.longitud??"",onChange:a=>r("longitud",a.target.value),placeholder:"Ej: -60.006261"})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:3,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Facebook"}),e.jsx(s.Control,{size:"sm",value:t.facebook||"",onChange:a=>r("facebook",a.target.value)})]})}),e.jsx(c,{md:3,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Instagram"}),e.jsx(s.Control,{size:"sm",value:t.instagram||"",onChange:a=>r("instagram",a.target.value)})]})}),e.jsx(c,{md:3,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Twitter"}),e.jsx(s.Control,{size:"sm",value:t.twitter||"",onChange:a=>r("twitter",a.target.value)})]})}),e.jsx(c,{md:3,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"TikTok"}),e.jsx(s.Control,{size:"sm",value:t.tiktok||"",onChange:a=>r("tiktok",a.target.value)})]})})]}),e.jsx(V,{images:t.imagenes||[],onChange:a=>u(f=>({...f,imagenes:a.map(S=>({imagenUrl:S}))})),maxImages:5,entityType:"espacio-publico",entityId:n?.id,pendingFiles:x,onPendingFile:a=>j(f=>[...f,a]),onRemovePendingFile:a=>j(f=>f.filter((S,M)=>M!==a))}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(N,{size:"sm",variant:"primary",onClick:D,disabled:d,children:d?e.jsx(P,{size:"sm"}):i?"Crear":"Guardar"}),!i&&n&&e.jsx(N,{size:"sm",variant:"outline-danger",onClick:()=>C(!0),children:"Eliminar"}),e.jsx(N,{size:"sm",variant:"secondary",onClick:()=>{L(null),z(!1)},children:"Cancelar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un item o crea uno nuevo"})]}),e.jsxs(G,{show:$,onHide:()=>C(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Confirmar"})}),e.jsxs(G.Body,{children:['¿Eliminar "',n?.titulo,'"?']}),e.jsxs(G.Footer,{children:[e.jsx(N,{variant:"secondary",onClick:()=>C(!1),children:"Cancelar"}),e.jsx(N,{variant:"danger",onClick:R,children:"Eliminar"})]})]})]})}const ae={nombreEvento:"",lugar:"",horario:"",fechaInicio:"",fechaFin:"",telefonoContacto:"",nombreContacto:"",descripcion:"",imagenes:[]};function fe(){const[k,T]=o.useState([]),[A,F]=o.useState(!0),[n,L]=o.useState(null),[i,z]=o.useState(!1),[t,u]=o.useState(ae),[d,w]=o.useState(!1),[I,v]=o.useState(null),[$,C]=o.useState(!1),[x,j]=o.useState([]);o.useEffect(()=>{m()},[]);const m=async()=>{try{F(!0);const a=await b.get("/evento");T(a.data||[])}catch(a){console.error("Error:",a)}finally{F(!1)}},h=a=>{L(a),z(!1),u({...a}),j([])},E=()=>{L(null),z(!0),u({...ae}),j([])},r=(a,f)=>{u(S=>({...S,[a]:f}))},D=async()=>{if(!t.nombreEvento){v({tipo:"danger",texto:"Nombre requerido"});return}w(!0);try{const a=i?"/evento":`/evento/${n?.id}`,{id:f,imagenes:S,...M}=t,g={...i?M:{...M,id:t.id}},l=(i?await b.post(a,g):await b.put(a,g)).data,p=i?l.id:n?.id;if(x.length>0&&p){for(const U of x){const O=new FormData;O.append("file",U);try{await b.post(`/evento/${p}/imagenes`,O,{headers:{"Content-Type":"multipart/form-data"}})}catch(W){console.error("Error subiendo imagen:",W)}}j([])}v({tipo:"success",texto:i?"Creado":"Actualizado"}),m(),i&&(z(!1),u(ae))}catch{v({tipo:"danger",texto:"Error de conexión"})}finally{w(!1),setTimeout(()=>v(null),3e3)}},R=async()=>{if(n)try{await b.delete(`/evento/${n.id}`),v({tipo:"success",texto:"Eliminado"}),L(null),u(ae),m()}catch{v({tipo:"danger",texto:"Error al eliminar"})}finally{C(!1),setTimeout(()=>v(null),3e3)}};return A?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(P,{size:"sm"})," Cargando..."]}):e.jsxs(y,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(N,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:E,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Agregar nuevo"})]}),e.jsxs(H,{style:{maxHeight:400,overflowY:"auto"},children:[k.map(a=>e.jsxs(H.Item,{action:!0,active:n?.id===a.id,onClick:()=>h(a),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:a.nombreEvento}),e.jsxs("small",{className:"text-muted",children:[a.fechaInicio," - ",a.lugar]})]},a.id)),k.length===0&&e.jsx(H.Item,{className:"text-muted",children:"Sin registros"})]})]}),e.jsxs(c,{md:8,children:[I&&e.jsx(q,{variant:I.tipo,className:"py-1 small",children:I.texto}),n||i?e.jsxs(s,{children:[e.jsx("h6",{children:i?"Nuevo Evento":`Editando: ${n?.nombreEvento}`}),!i&&n&&e.jsx(y,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:n.id,disabled:!0})]})})}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Nombre *"}),e.jsx(s.Control,{size:"sm",value:t.nombreEvento||"",onChange:a=>r("nombreEvento",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Lugar *"}),e.jsx(s.Control,{size:"sm",value:t.lugar||"",onChange:a=>r("lugar",a.target.value)})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Fecha Inicio *"}),e.jsx(s.Control,{size:"sm",type:"date",value:t.fechaInicio||"",onChange:a=>r("fechaInicio",a.target.value)})]})}),e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Fecha Fin"}),e.jsx(s.Control,{size:"sm",type:"date",value:t.fechaFin||"",onChange:a=>r("fechaFin",a.target.value)})]})}),e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Horario *"}),e.jsx(s.Control,{size:"sm",value:t.horario||"",onChange:a=>r("horario",a.target.value)})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Nombre Contacto *"}),e.jsx(s.Control,{size:"sm",value:t.nombreContacto||"",onChange:a=>r("nombreContacto",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Teléfono Contacto *"}),e.jsx(s.Control,{size:"sm",value:t.telefonoContacto||"",onChange:a=>r("telefonoContacto",a.target.value)})]})})]}),e.jsx(y,{children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Descripcion"}),e.jsx(s.Control,{as:"textarea",rows:3,size:"sm",value:t.descripcion||"",onChange:a=>r("descripcion",a.target.value)})]})})}),e.jsx(V,{images:t.imagenes||[],onChange:a=>u(f=>({...f,imagenes:a.map(S=>({imagenUrl:S}))})),maxImages:5,entityType:"evento",entityId:n?.id,pendingFiles:x,onPendingFile:a=>j(f=>[...f,a]),onRemovePendingFile:a=>j(f=>f.filter((S,M)=>M!==a))}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(N,{size:"sm",variant:"primary",onClick:D,disabled:d,children:d?e.jsx(P,{size:"sm"}):i?"Crear":"Guardar"}),!i&&n&&e.jsx(N,{size:"sm",variant:"outline-danger",onClick:()=>C(!0),children:"Eliminar"}),e.jsx(N,{size:"sm",variant:"secondary",onClick:()=>{L(null),z(!1)},children:"Cancelar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un item o crea uno nuevo"})]}),e.jsxs(G,{show:$,onHide:()=>C(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Confirmar"})}),e.jsxs(G.Body,{children:['¿Eliminar "',n?.nombreEvento,'"?']}),e.jsxs(G.Footer,{children:[e.jsx(N,{variant:"secondary",onClick:()=>C(!1),children:"Cancelar"}),e.jsx(N,{variant:"danger",onClick:R,children:"Eliminar"})]})]})]})}const te={name:"",address:"",email:"",latitude:void 0,longitude:void 0,categories:"",phones:"",schedule:"",delivery:!1,imagenes:[],userId:void 0};function Ne(){const[k,T]=o.useState([]),[A,F]=o.useState([]),[n,L]=o.useState(!0),[i,z]=o.useState(null),[t,u]=o.useState(!1),[d,w]=o.useState(te),[I,v]=o.useState(!1),[$,C]=o.useState(null),[x,j]=o.useState(!1),[m,h]=o.useState(null),[E,r]=o.useState([]);o.useEffect(()=>{D(),R()},[]);const D=async()=>{try{L(!0);const l=await b.get("/gastronomia/restaurants");T(l.data||[])}catch(l){console.error("Error:",l)}finally{L(!1)}},R=async()=>{try{const l=await b.get("/user/administradores");F(l.data||[])}catch(l){console.error("Error cargando administradores:",l)}},a=async l=>{z(l),u(!1),w({...l}),r([]),await M(l.id)},f=()=>{z(null),u(!0),w({...te}),C(null),h(null),r([])},S=(l,p)=>{w(U=>({...U,[l]:p}))},M=async l=>{try{const p=await b.get(`/business/external/${l}/type/GASTRONOMIA`);h(p.data),w(U=>({...U,userId:p.data.ownerId}))}catch(p){p?.response?.status===404?(h(null),w(U=>({...U,userId:void 0}))):(console.error("Error loading business:",p),h(null))}},g=async()=>{if(!d.name){C({tipo:"danger",texto:"Nombre requerido"});return}v(!0);try{const l=t?"/gastronomia":`/gastronomia/${i?.id}`,{id:p,imagenes:U,userId:O,...W}=d,K={...t?W:{...W,id:d.id},address:d.address?.trim()||void 0,email:d.email?.trim()||void 0,categories:d.categories?.trim()||void 0,phones:d.phones?.trim()||void 0,schedule:d.schedule?.trim()||void 0,latitude:d.latitude!=null&&String(d.latitude).trim()!==""?parseFloat(String(d.latitude)):void 0,longitude:d.longitude!=null&&String(d.longitude).trim()!==""?parseFloat(String(d.longitude)):void 0},Q=(t?await b.post(l,K):await b.put(l,K)).data,X=t?Q.id:i?.id;if(E.length>0&&X){for(const _ of E){const J=new FormData;J.append("file",_);try{await b.post(`/restaurante/${X}/imagenes`,J,{headers:{"Content-Type":"multipart/form-data"}})}catch(ie){console.error("Error subiendo imagen:",ie)}}r([])}if(t&&d.userId){const _={ownerId:d.userId,name:d.name,businessType:"GASTRONOMIA",externalBusinessId:Q.id};try{await b.post("/business",_)}catch{console.warn("No se pudo asignar el administrador al negocio")}}if(!t&&m&&d.userId&&d.userId!==m.ownerId){const _={ownerId:d.userId};try{const J=await b.patch(`/business/${m.id}/owner`,_);h(J.data)}catch{console.warn("No se pudo actualizar el administrador del negocio")}}if(!t&&!m&&d.userId&&i?.id){const _={ownerId:d.userId,name:d.name,businessType:"GASTRONOMIA",externalBusinessId:i.id};try{const J=await b.post("/business",_);h(J.data)}catch{console.warn("No se pudo crear el administrador del negocio")}}C({tipo:"success",texto:t?"Creado":"Actualizado"}),D(),t&&(u(!1),w(te))}catch{C({tipo:"danger",texto:"Error de conexión"})}finally{v(!1),setTimeout(()=>C(null),3e3)}},B=async()=>{if(i)try{await b.delete(`/gastronomia/delete/${i.id}`),C({tipo:"success",texto:"Eliminado"}),z(null),w(te),D()}catch{C({tipo:"danger",texto:"Error al eliminar"})}finally{j(!1),setTimeout(()=>C(null),3e3)}};return n?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(P,{size:"sm"})," Cargando..."]}):e.jsxs(y,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(N,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:f,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Agregar nuevo"})]}),e.jsxs(H,{style:{maxHeight:400,overflowY:"auto"},children:[k.map(l=>e.jsxs(H.Item,{action:!0,active:i?.id===l.id,onClick:()=>a(l),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:l.name}),e.jsx("small",{className:"text-muted",children:l.address||l.categories})]},l.id)),k.length===0&&e.jsx(H.Item,{className:"text-muted",children:"Sin registros"})]})]}),e.jsxs(c,{md:8,children:[$&&e.jsx(q,{variant:$.tipo,className:"py-1 small",children:$.texto}),i||t?e.jsxs(s,{children:[e.jsx("h6",{children:t?"Nuevo Local Gastronómico":`Editando: ${i?.name}`}),!t&&i&&e.jsx(y,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:i.id,disabled:!0})]})})}),e.jsx(y,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"Administrador/Dueño"}),e.jsxs(s.Select,{size:"sm",value:d.userId||"",onChange:l=>{const p=l.target.value;S("userId",p?parseInt(p):void 0)},children:[e.jsx("option",{value:"",children:"Seleccionar administrador..."}),A.map(l=>e.jsxs("option",{value:l.id,children:[l.firstName," ",l.lastName," (",l.email,")"]},l.id))]})]})})}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Nombre *"}),e.jsx(s.Control,{size:"sm",value:d.name||"",onChange:l=>S("name",l.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Email"}),e.jsx(s.Control,{size:"sm",type:"email",value:d.email||"",onChange:l=>S("email",l.target.value)})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Dirección"}),e.jsx(s.Control,{size:"sm",value:d.address||"",onChange:l=>S("address",l.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Categorías"}),e.jsx(s.Control,{size:"sm",value:d.categories||"",onChange:l=>S("categories",l.target.value),placeholder:"Pizza, Empanadas"})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Teléfonos"}),e.jsx(s.Control,{size:"sm",value:d.phones||"",onChange:l=>S("phones",l.target.value),placeholder:"123456, 789012"})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Horarios"}),e.jsx(s.Control,{size:"sm",value:d.schedule||"",onChange:l=>S("schedule",l.target.value),placeholder:"1:09:00-22:00; 2:09:00-22:00"})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Latitud"}),e.jsx(s.Control,{size:"sm",value:d.latitude??"",onChange:l=>S("latitude",l.target.value),placeholder:"Ej: -36.345099"})]})}),e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Longitud"}),e.jsx(s.Control,{size:"sm",value:d.longitude??"",onChange:l=>S("longitude",l.target.value),placeholder:"Ej: -60.006261"})]})}),e.jsx(c,{md:4,children:e.jsx(s.Group,{className:"mb-2 pt-4",children:e.jsx(s.Check,{type:"checkbox",label:"Delivery",checked:d.delivery||!1,onChange:l=>S("delivery",l.target.checked)})})})]}),e.jsx(V,{images:d.imagenes||[],onChange:l=>w(p=>({...p,imagenes:l.map(U=>({imagenUrl:U}))})),maxImages:5,entityType:"gastronomia",entityId:i?.id,pendingFiles:E,onPendingFile:l=>r(p=>[...p,l]),onRemovePendingFile:l=>r(p=>p.filter((U,O)=>O!==l))}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(N,{size:"sm",variant:"primary",onClick:g,disabled:I,children:I?e.jsx(P,{size:"sm"}):t?"Crear":"Guardar"}),!t&&i&&e.jsx(N,{size:"sm",variant:"outline-danger",onClick:()=>j(!0),children:"Eliminar"}),e.jsx(N,{size:"sm",variant:"secondary",onClick:()=>{z(null),u(!1),C(null)},children:"Cancelar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un item o crea uno nuevo"})]}),e.jsxs(G,{show:x,onHide:()=>j(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Confirmar"})}),e.jsxs(G.Body,{children:['¿Eliminar "',i?.name,'"?']}),e.jsxs(G.Footer,{children:[e.jsx(N,{variant:"secondary",onClick:()=>j(!1),children:"Cancelar"}),e.jsx(N,{variant:"danger",onClick:B,children:"Eliminar"})]})]})]})}const le={titulo:"",description:"",ubicacion:"",latitud:"",longitud:"",numWhatsapp:"",tipoHospedaje:"HOTEL",imagenes:[],userId:void 0};function Ce(){const[k,T]=o.useState([]),[A,F]=o.useState([]),[n,L]=o.useState(!0),[i,z]=o.useState(null),[t,u]=o.useState(!1),[d,w]=o.useState(le),[I,v]=o.useState(!1),[$,C]=o.useState(null),[x,j]=o.useState(!1),[m,h]=o.useState(null),[E,r]=o.useState([]);o.useEffect(()=>{D(),R()},[]);const D=async()=>{try{L(!0);const l=await b.get("/hospedajes");T(l.data||[]),console.log("Hospedajes cargados desde API:",l.data)}catch(l){console.error("Error cargando hospedajes:",l),T([])}finally{L(!1)}},R=async()=>{try{const l=await b.get("/user/administradores");F(l.data||[])}catch(l){console.error("Error cargando administradores:",l)}},a=async l=>{console.log("Hospedaje seleccionado:",l),z(l),u(!1),w({...l}),r([]),await M(l.id)},f=()=>{z(null),u(!0),w({...le}),h(null),r([])},S=(l,p)=>{w(U=>({...U,[l]:p}))},M=async l=>{try{const p=await b.get(`/business/external/${l}/type/HOSPEDAJE`);h(p.data),w(U=>({...U,userId:p.data.ownerId}))}catch(p){p?.response?.status===404?(h(null),w(U=>({...U,userId:void 0}))):(console.error("Error loading business:",p),h(null))}},g=async()=>{if(!d.titulo){C({tipo:"danger",texto:"Título requerido"});return}v(!0);try{const l=t?"/hospedajes":`/hospedajes/${i?.id}`,{id:p,imagenes:U,userId:O,...W}=d,K={...t?W:{...W,id:d.id},description:d.description?.trim()||"",ubicacion:d.ubicacion?.trim()||void 0,latitud:d.latitud?parseFloat(d.latitud):void 0,longitud:d.longitud?parseFloat(d.longitud):void 0,numWhatsapp:d.numWhatsapp?.trim()||void 0};console.log("Enviando hospedaje:",K),console.log("URL:",l);const ne=t?await b.post(l,K):await b.put(l,K);console.log("Respuesta:",ne.data);const Q=ne.data,X=t?Q.id:i?.id;if(E.length>0&&X){for(const _ of E){const J=new FormData;J.append("file",_);try{await b.post(`/hospedajes/${X}/imagenes`,J,{headers:{"Content-Type":"multipart/form-data"}})}catch(ie){console.error("Error subiendo imagen:",ie)}}r([])}if(t&&d.userId){const _={ownerId:d.userId,name:d.titulo,businessType:"HOSPEDAJE",externalBusinessId:Q.id};try{await b.post("/business",_)}catch{console.warn("No se pudo asignar el administrador al negocio")}}if(!t&&m&&d.userId&&d.userId!==m.ownerId){const _={ownerId:d.userId};try{const J=await b.patch(`/business/${m.id}/owner`,_);h(J.data)}catch{console.warn("No se pudo actualizar el administrador del negocio")}}if(!t&&!m&&d.userId&&i?.id){const _={ownerId:d.userId,name:d.titulo,businessType:"HOSPEDAJE",externalBusinessId:i.id};try{const J=await b.post("/business",_);h(J.data)}catch{console.warn("No se pudo crear el administrador del negocio")}}C({tipo:"success",texto:t?"Creado":"Actualizado"}),D(),t&&(u(!1),w(le))}catch(l){console.error("Error en handleSave de hospedaje:",l);const p=l.response?.data||{};C({tipo:"danger",texto:p.message||p.error||"Error de conexión"})}finally{v(!1),setTimeout(()=>C(null),3e3)}},B=async()=>{if(i)try{await b.delete(`/hospedajes/${i.id}`),C({tipo:"success",texto:"Eliminado"}),z(null),w(le),D()}catch(l){console.error("Error en handleDelete de hospedaje:",l);const p=l.response?.data||{};C({tipo:"danger",texto:p.message||p.error||"Error al eliminar"})}finally{j(!1),setTimeout(()=>C(null),3e3)}};return n?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(P,{size:"sm"})," Cargando..."]}):e.jsxs(y,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(N,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:f,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Agregar nuevo"})]}),e.jsxs(H,{style:{maxHeight:400,overflowY:"auto"},children:[k.map(l=>e.jsxs(H.Item,{action:!0,active:i?.id===l.id,onClick:()=>a(l),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:l.titulo}),e.jsxs("small",{className:"text-muted",children:[l.tipoHospedaje," - ",l.ubicacion]})]},l.id)),k.length===0&&e.jsx(H.Item,{className:"text-muted",children:"Sin registros"})]})]}),e.jsxs(c,{md:8,children:[$&&e.jsx(q,{variant:$.tipo,className:"py-1 small",children:$.texto}),i||t?e.jsxs(s,{children:[e.jsx("h6",{children:t?"Nuevo Hospedaje":`Editando: ${i?.titulo}`}),!t&&i&&e.jsx(y,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:i.id,disabled:!0})]})})}),e.jsx(y,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"Administrador/Dueño"}),e.jsxs(s.Select,{size:"sm",value:d.userId||"",onChange:l=>{const p=l.target.value;S("userId",p?parseInt(p):void 0)},children:[e.jsx("option",{value:"",children:"Seleccionar administrador..."}),A.map(l=>e.jsxs("option",{value:l.id,children:[l.firstName," ",l.lastName," (",l.email,")"]},l.id))]})]})})}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Título *"}),e.jsx(s.Control,{size:"sm",value:d.titulo||"",onChange:l=>S("titulo",l.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Tipo *"}),e.jsxs(s.Select,{size:"sm",value:d.tipoHospedaje||"HOTEL",onChange:l=>S("tipoHospedaje",l.target.value),children:[e.jsx("option",{value:"HOTEL",children:"Hotel"}),e.jsx("option",{value:"DEPARTAMENTO",children:"Departamento"}),e.jsx("option",{value:"CABAÑA",children:"Cabaña"}),e.jsx("option",{value:"CASA",children:"Casa"}),e.jsx("option",{value:"OTRO",children:"Otro"})]})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Descripción"}),e.jsx(s.Control,{size:"sm",as:"textarea",rows:2,value:d.description||"",onChange:l=>S("description",l.target.value)})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Ubicación *"}),e.jsx(s.Control,{size:"sm",value:d.ubicacion||"",onChange:l=>S("ubicacion",l.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"WhatsApp"}),e.jsx(s.Control,{size:"sm",value:d.numWhatsapp||"",onChange:l=>S("numWhatsapp",l.target.value)})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Latitud *"}),e.jsx(s.Control,{size:"sm",value:d.latitud||"",onChange:l=>S("latitud",l.target.value),placeholder:"-36.3576"})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Longitud *"}),e.jsx(s.Control,{size:"sm",value:d.longitud||"",onChange:l=>S("longitud",l.target.value),placeholder:"-60.0167"})]})})]}),e.jsx(V,{images:d.imagenes||[],onChange:l=>w(p=>({...p,imagenes:l.map(U=>({imagenUrl:U}))})),maxImages:5,entityType:"hospedaje",entityId:i?.id,pendingFiles:E,onPendingFile:l=>r(p=>[...p,l]),onRemovePendingFile:l=>r(p=>p.filter((U,O)=>O!==l))}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(N,{size:"sm",variant:"primary",onClick:g,disabled:I,children:I?e.jsx(P,{size:"sm"}):t?"Crear":"Guardar"}),!t&&i&&e.jsx(N,{size:"sm",variant:"outline-danger",onClick:()=>j(!0),children:"Eliminar"}),e.jsx(N,{size:"sm",variant:"secondary",onClick:()=>{z(null),u(!1)},children:"Cancelar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un item o crea uno nuevo"})]}),e.jsxs(G,{show:x,onHide:()=>j(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Confirmar"})}),e.jsxs(G.Body,{children:['¿Eliminar "',i?.titulo,'"?']}),e.jsxs(G.Footer,{children:[e.jsx(N,{variant:"secondary",onClick:()=>j(!1),children:"Cancelar"}),e.jsx(N,{variant:"danger",onClick:B,children:"Eliminar"})]})]})]})}const re={titulo:"",descripcion:"",direccion:"",horario:"",telefono:"",latitud:void 0,longitud:void 0,facebook:"",instagram:"",tag:"",imagenes:[]};function ye(){const[k,T]=o.useState([]),[A,F]=o.useState(!0),[n,L]=o.useState(null),[i,z]=o.useState(!1),[t,u]=o.useState(re),[d,w]=o.useState(!1),[I,v]=o.useState(null),[$,C]=o.useState(!1),[x,j]=o.useState([]);o.useEffect(()=>{m()},[]);const m=async()=>{try{F(!0);const a=await b.get("/servicio");T(a.data||[])}catch(a){console.error("Error:",a)}finally{F(!1)}},h=a=>{L(a),z(!1),u({...a}),j([])},E=()=>{L(null),z(!0),u({...re}),j([])},r=(a,f)=>{u(S=>({...S,[a]:f}))},D=async()=>{if(!t.titulo){v({tipo:"danger",texto:"Título requerido"});return}w(!0);try{const a=i?"/servicio":`/servicio/${n?.id}`,{id:f,imagenes:S,...M}=t,g={...i?M:{...M,id:t.id},descripcion:t.descripcion?.trim()||void 0,telefono:t.telefono?.trim()||void 0,facebook:t.facebook?.trim()||void 0,instagram:t.instagram?.trim()||void 0,latitud:t.latitud!=null&&String(t.latitud).trim()!==""?parseFloat(String(t.latitud)):void 0,longitud:t.longitud!=null&&String(t.longitud).trim()!==""?parseFloat(String(t.longitud)):void 0,tag:t.tag?.trim().toUpperCase()||void 0},l=(i?await b.post(a,g):await b.put(a,g)).data,p=i?l.id:n?.id;if(x.length>0&&p){for(const U of x){const O=new FormData;O.append("file",U);try{await b.post(`/servicio/${p}/imagenes`,O,{headers:{"Content-Type":"multipart/form-data"}})}catch(W){console.error("Error subiendo imagen:",W)}}j([])}v({tipo:"success",texto:i?"Creado":"Actualizado"}),m(),i&&(z(!1),u(re))}catch{v({tipo:"danger",texto:"Error de conexión"})}finally{w(!1),setTimeout(()=>v(null),3e3)}},R=async()=>{if(n)try{await b.delete(`/servicio/${n.id}`),v({tipo:"success",texto:"Eliminado"}),L(null),u(re),m()}catch{v({tipo:"danger",texto:"Error al eliminar"})}finally{C(!1),setTimeout(()=>v(null),3e3)}};return A?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(P,{size:"sm"})," Cargando..."]}):e.jsxs(y,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(N,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:E,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Agregar nuevo"})]}),e.jsxs(H,{style:{maxHeight:400,overflowY:"auto"},children:[k.map(a=>e.jsxs(H.Item,{action:!0,active:n?.id===a.id,onClick:()=>h(a),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:a.titulo}),e.jsx("small",{className:"text-muted",children:a.direccion})]},a.id)),k.length===0&&e.jsx(H.Item,{className:"text-muted",children:"Sin registros"})]})]}),e.jsxs(c,{md:8,children:[I&&e.jsx(q,{variant:I.tipo,className:"py-1 small",children:I.texto}),n||i?e.jsxs(s,{children:[e.jsx("h6",{children:i?"Nuevo Servicio":`Editando: ${n?.titulo}`}),!i&&n&&e.jsx(y,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:n.id,disabled:!0})]})})}),e.jsxs(y,{children:[e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Título *"}),e.jsx(s.Control,{size:"sm",value:t.titulo||"",onChange:a=>r("titulo",a.target.value)})]})}),e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Tag"}),e.jsx(s.Control,{size:"sm",placeholder:"Ej: REMIS",value:t.tag||"",onChange:a=>r("tag",a.target.value.toUpperCase())})]})}),e.jsx(c,{md:4,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Teléfono"}),e.jsx(s.Control,{size:"sm",value:t.telefono||"",onChange:a=>r("telefono",a.target.value)})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Descripción"}),e.jsx(s.Control,{size:"sm",as:"textarea",rows:2,value:t.descripcion||"",onChange:a=>r("descripcion",a.target.value)})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Dirección"}),e.jsx(s.Control,{size:"sm",value:t.direccion||"",onChange:a=>r("direccion",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Horario"}),e.jsx(s.Control,{size:"sm",value:t.horario||"",onChange:a=>r("horario",a.target.value)})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Latitud"}),e.jsx(s.Control,{size:"sm",value:t.latitud??"",onChange:a=>r("latitud",a.target.value),placeholder:"Ej: -36.345099"})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Longitud"}),e.jsx(s.Control,{size:"sm",value:t.longitud??"",onChange:a=>r("longitud",a.target.value),placeholder:"Ej: -60.006261"})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Facebook"}),e.jsx(s.Control,{size:"sm",value:t.facebook||"",onChange:a=>r("facebook",a.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Instagram"}),e.jsx(s.Control,{size:"sm",value:t.instagram||"",onChange:a=>r("instagram",a.target.value)})]})})]}),e.jsx(V,{images:t.imagenes||[],onChange:a=>u(f=>({...f,imagenes:a.map(S=>({imagenUrl:S}))})),maxImages:5,entityType:"servicio",entityId:n?.id,pendingFiles:x,onPendingFile:a=>j(f=>[...f,a]),onRemovePendingFile:a=>j(f=>f.filter((S,M)=>M!==a))}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(N,{size:"sm",variant:"primary",onClick:D,disabled:d,children:d?e.jsx(P,{size:"sm"}):i?"Crear":"Guardar"}),!i&&n&&e.jsx(N,{size:"sm",variant:"outline-danger",onClick:()=>C(!0),children:"Eliminar"}),e.jsx(N,{size:"sm",variant:"secondary",onClick:()=>{L(null),z(!1)},children:"Cancelar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un item o crea uno nuevo"})]}),e.jsxs(G,{show:$,onHide:()=>C(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Confirmar"})}),e.jsxs(G.Body,{children:['¿Eliminar "',n?.titulo,'"?']}),e.jsxs(G.Footer,{children:[e.jsx(N,{variant:"secondary",onClick:()=>C(!1),children:"Cancelar"}),e.jsx(N,{variant:"danger",onClick:R,children:"Eliminar"})]})]})]})}const de={titulo:"",description:"",direccion:"",horario:"",telefono:"",latitud:void 0,longitud:void 0,facebook:"",instagram:"",imagenes:[]};function Se(){const[k,T]=o.useState([]),[A,F]=o.useState(!0),[n,L]=o.useState(null),[i,z]=o.useState(!1),[t,u]=o.useState(de),[d,w]=o.useState(!1),[I,v]=o.useState(null),[$,C]=o.useState([]);o.useEffect(()=>{x()},[]);const x=async()=>{try{F(!0);const r=await b.get("/terma");console.log("Termas cargadas:",r.data),T(r.data||[])}catch(r){console.error("Error:",r),T([])}finally{F(!1)}},j=r=>{L(r),z(!1),u({...r}),C([])},m=()=>{L(null),z(!0),u({...de}),C([])},h=(r,D)=>{u(R=>({...R,[r]:D}))},E=async()=>{if(!t.titulo){v({tipo:"danger",texto:"Título requerido"});return}w(!0);try{const r=i?"/terma":`/terma/${n?.id}`,{id:D,description:R,...a}=t,f={...i?a:{...t,description:void 0},descripcion:t.description?.trim()||void 0,direccion:t.direccion?.trim()||void 0,horario:t.horario?.trim()||void 0,telefono:t.telefono?.trim()||void 0,latitud:t.latitud!=null&&String(t.latitud).trim()!==""?parseFloat(String(t.latitud)):void 0,longitud:t.longitud!=null&&String(t.longitud).trim()!==""?parseFloat(String(t.longitud)):void 0,facebook:t.facebook?.trim()||void 0,instagram:t.instagram?.trim()||void 0},M=(i?await b.post(r,f):await b.patch(r,f)).data,g=i?M.id:n?.id;if($.length>0&&g){for(const B of $){const l=new FormData;l.append("file",B);try{await b.post(`/terma/${g}/imagenes`,l,{headers:{"Content-Type":"multipart/form-data"}})}catch(p){console.error("Error subiendo imagen:",p)}}C([])}v({tipo:"success",texto:i?"Creado":"Actualizado"}),x(),i&&(z(!1),u(de))}catch(r){console.error("Error en handleSave:",r);const D=r.response?.data||{};v({tipo:"danger",texto:D.message||D.error||"Error de conexión"})}finally{w(!1),setTimeout(()=>v(null),3e3)}};return A?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(P,{size:"sm"})," Cargando..."]}):e.jsxs(y,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(N,{variant:"success",size:"sm",className:"rounded-circle me-2",onClick:m,style:{width:32,height:32},children:"+"}),e.jsx("small",{className:"text-muted",children:"Crear primera terma"})]}),e.jsxs(H,{style:{maxHeight:400,overflowY:"auto"},children:[k.map(r=>e.jsxs(H.Item,{action:!0,active:n?.id===r.id,onClick:()=>j(r),className:"py-2",children:[e.jsx("div",{className:"fw-bold small",children:r.titulo}),e.jsx("small",{className:"text-muted",children:r.direccion})]},r.id)),k.length===0&&e.jsx(H.Item,{className:"text-muted",children:"Sin registros - crea la primera"})]})]}),e.jsxs(c,{md:8,children:[I&&e.jsx(q,{variant:I.tipo,className:"py-1 small",children:I.texto}),n||i?e.jsxs(s,{children:[e.jsx("h6",{children:i?"Nueva Terma":`Editando: ${n?.titulo}`}),!i&&n&&e.jsx(y,{className:"mb-2",children:e.jsx(c,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{className:"small mb-0",children:"ID"}),e.jsx(s.Control,{size:"sm",value:n.id,disabled:!0})]})})}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Título *"}),e.jsx(s.Control,{size:"sm",value:t.titulo||"",onChange:r=>h("titulo",r.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Teléfono"}),e.jsx(s.Control,{size:"sm",value:t.telefono||"",onChange:r=>h("telefono",r.target.value)})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Descripción"}),e.jsx(s.Control,{size:"sm",as:"textarea",rows:2,value:t.description||"",onChange:r=>h("description",r.target.value)})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Dirección"}),e.jsx(s.Control,{size:"sm",value:t.direccion||"",onChange:r=>h("direccion",r.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Horario"}),e.jsx(s.Control,{size:"sm",value:t.horario||"",onChange:r=>h("horario",r.target.value)})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Latitud"}),e.jsx(s.Control,{size:"sm",value:t.latitud??"",onChange:r=>h("latitud",r.target.value),placeholder:"Ej: -36.345099"})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Longitud"}),e.jsx(s.Control,{size:"sm",value:t.longitud??"",onChange:r=>h("longitud",r.target.value),placeholder:"Ej: -60.006261"})]})})]}),e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Facebook"}),e.jsx(s.Control,{size:"sm",value:t.facebook||"",onChange:r=>h("facebook",r.target.value)})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Instagram"}),e.jsx(s.Control,{size:"sm",value:t.instagram||"",onChange:r=>h("instagram",r.target.value)})]})})]}),e.jsx(V,{images:t.imagenes||[],onChange:r=>u(D=>({...D,imagenes:r.map(R=>({imagenUrl:R}))})),maxImages:5,entityType:"terma",entityId:n?.id,pendingFiles:$,onPendingFile:r=>C(D=>[...D,r]),onRemovePendingFile:r=>C(D=>D.filter((R,a)=>a!==r))}),n?.imagenes&&n.imagenes.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-1",children:"Imágenes"}),e.jsx("div",{className:"d-flex gap-1 flex-wrap",children:n.imagenes.map((r,D)=>e.jsx("img",{src:r.imagenUrl,alt:"",style:{width:60,height:60,objectFit:"cover"}},D))})]}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[e.jsx(N,{size:"sm",variant:"primary",onClick:E,disabled:d,children:d?e.jsx(P,{size:"sm"}):i?"Crear":"Guardar"}),e.jsx(N,{size:"sm",variant:"secondary",onClick:()=>{L(null),z(!1)},children:"Cancelar"}),!i&&n&&e.jsx(N,{size:"sm",variant:"danger",onClick:async()=>{if(window.confirm("¿Estás seguro de eliminar esta terma?")){try{await b.delete(`/terma/${n.id}`),v({tipo:"success",texto:"Terma eliminada"}),L(null),x()}catch{v({tipo:"danger",texto:"Error al eliminar"})}setTimeout(()=>v(null),3e3)}},children:"Eliminar"})]})]}):e.jsx("p",{className:"text-muted",children:"Selecciona la terma para editar o crea una nueva"})]})]})}const ue={firstName:"",lastName:"",email:"",password:"",role:"USER"},we=[{value:"",label:"Todos"},{value:"USER",label:"Usuario"},{value:"ADMINISTRADOR",label:"Administrador"},{value:"MODERADOR",label:"Moderador"}];function Ee(){const[k,T]=o.useState([]),[A,F]=o.useState(!0),[n,L]=o.useState(null),[i,z]=o.useState(""),[t,u]=o.useState(null),[d,w]=o.useState(!1),[I,v]=o.useState(!1),[$,C]=o.useState(""),[x,j]=o.useState(ue),[m,h]=o.useState(!1),[E,r]=o.useState(!1);o.useEffect(()=>{R()},[]);const D=o.useMemo(()=>i?k.filter(g=>g.rol===i):k,[k,i]),R=async()=>{try{F(!0);const g=await fetch("/api/user/all",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(g.ok){const B=await g.json();T(B)}else console.warn("API respondió con error:",g.status),T([])}catch(g){console.error("Error cargando usuarios:",g),T([])}finally{F(!1)}},a=g=>{L(g)},f=async()=>{if(!(!n||!$)){h(!0);try{const g=localStorage.getItem("token"),B=await fetch(`/api/user/${n.id}/role`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({role:$})});if(B.ok)u({tipo:"success",texto:"Rol actualizado"}),R(),w(!1),L(null);else{const l=await B.json().catch(()=>({}));u({tipo:"danger",texto:l.error||l.detalle||"Error al cambiar rol"})}}catch(g){console.error("Error:",g),u({tipo:"danger",texto:"Error de conexión"})}finally{h(!1),setTimeout(()=>u(null),3e3)}}},S=async()=>{if(!x.firstName||!x.email||!x.password){u({tipo:"danger",texto:"Nombre, email y contraseña son requeridos"});return}h(!0);try{const g=localStorage.getItem("token"),B={correo:x.email,nombre:x.firstName,contrasenia:x.password,role:x.role},l=await fetch("/api/user/moderador/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify(B)});if(l.ok)u({tipo:"success",texto:"Usuario creado correctamente"}),v(!1),j(ue),R();else{const p=await l.json().catch(()=>({}));u({tipo:"danger",texto:p.error||p.detalle||"Error al crear usuario"})}}catch(g){console.error("Error:",g),u({tipo:"danger",texto:"Error de conexión"})}finally{h(!1),setTimeout(()=>u(null),3e3)}},M=g=>{switch(g){case"MODERADOR":return e.jsx(Y,{bg:"danger",children:"Moderador"});case"ADMINISTRADOR":return e.jsx(Y,{bg:"warning",text:"dark",children:"Administrador"});case"USER":return e.jsx(Y,{bg:"secondary",children:"Usuario"});default:return e.jsx(Y,{bg:"light",text:"dark",children:g})}};return A?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(P,{size:"sm"})," Cargando..."]}):e.jsxs(y,{children:[e.jsxs(c,{md:4,children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("small",{className:"text-muted",children:[D.length," de ",k.length," usuario(s)"]}),e.jsx(N,{variant:"success",size:"sm",onClick:()=>v(!0),children:"+ Nuevo"})]}),e.jsx(s.Select,{size:"sm",className:"mb-2",value:i,onChange:g=>{z(g.target.value),L(null)},children:we.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))}),e.jsxs(H,{style:{maxHeight:400,overflowY:"auto"},children:[D.map(g=>e.jsx(H.Item,{action:!0,active:n?.id===g.id,onClick:()=>a(g),className:"py-2",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"fw-bold small",children:[g.nombre," ",g.apellido]}),e.jsx("small",{className:"text-muted",children:g.email})]}),M(g.rol)]})},g.id)),D.length===0&&e.jsx(H.Item,{className:"text-muted",children:i?"Sin usuarios con ese rol":"Sin usuarios registrados"})]})]}),e.jsxs(c,{md:8,children:[t&&e.jsx(q,{variant:t.tipo,className:"py-1 small",children:t.texto}),n?e.jsxs("div",{children:[e.jsx("h6",{children:"Detalles del Usuario"}),e.jsx("table",{className:"table table-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"text-muted",style:{width:"30%"},children:"Nombre"}),e.jsxs("td",{children:[n.nombre," ",n.apellido]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-muted",children:"Email"}),e.jsxs("td",{children:[n.email,n.emailVerified?e.jsx(Y,{bg:"success",className:"ms-2",children:"Verificado"}):e.jsx(Y,{bg:"warning",text:"dark",className:"ms-2",children:"No verificado"})]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-muted",children:"Rol"}),e.jsx("td",{children:M(n.rol)})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"text-muted",children:"Estado"}),e.jsx("td",{children:n.activo?e.jsx(Y,{bg:"success",children:"Activo"}):e.jsx(Y,{bg:"danger",children:"Inactivo"})})]}),n.direccion&&e.jsxs("tr",{children:[e.jsx("th",{className:"text-muted",children:"Direccion"}),e.jsx("td",{children:n.direccion})]})]})}),e.jsx(N,{size:"sm",variant:"outline-primary",onClick:()=>{C(n.rol),w(!0)},children:"Cambiar Rol"})]}):e.jsx("p",{className:"text-muted",children:"Selecciona un usuario para ver detalles"})]}),e.jsxs(G,{show:d,onHide:()=>w(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Cambiar Rol"})}),e.jsxs(G.Body,{children:[e.jsxs("p",{children:["Cambiar rol de ",e.jsxs("strong",{children:[n?.nombre," ",n?.apellido]})]}),e.jsxs(s.Select,{value:$,onChange:g=>C(g.target.value),children:[e.jsx("option",{value:"USER",children:"Usuario"}),e.jsx("option",{value:"ADMINISTRADOR",children:"Administrador"}),e.jsx("option",{value:"MODERADOR",children:"Moderador"})]}),e.jsxs("small",{className:"text-muted mt-2 d-block",children:[e.jsx("strong",{children:"Usuario:"})," Acceso basico.",e.jsx("br",{}),e.jsx("strong",{children:"Administrador:"})," Gestiona comercios/negocios asignados.",e.jsx("br",{}),e.jsx("strong",{children:"Moderador:"})," Acceso total al panel de moderacion."]})]}),e.jsxs(G.Footer,{children:[e.jsx(N,{variant:"secondary",onClick:()=>w(!1),children:"Cancelar"}),e.jsx(N,{variant:"primary",onClick:f,disabled:m,children:m?e.jsx(P,{size:"sm"}):"Guardar"})]})]}),e.jsxs(G,{show:I,onHide:()=>v(!1),children:[e.jsx(G.Header,{closeButton:!0,children:e.jsx(G.Title,{children:"Crear Usuario"})}),e.jsx(G.Body,{children:e.jsxs(s,{children:[e.jsxs(y,{children:[e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Nombre *"}),e.jsx(s.Control,{size:"sm",value:x.firstName,onChange:g=>j({...x,firstName:g.target.value})})]})}),e.jsx(c,{md:6,children:e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Apellido"}),e.jsx(s.Control,{size:"sm",value:x.lastName,onChange:g=>j({...x,lastName:g.target.value})})]})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Email *"}),e.jsx(s.Control,{size:"sm",type:"email",value:x.email,onChange:g=>j({...x,email:g.target.value})})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Contraseña *"}),e.jsxs("div",{className:"position-relative",children:[e.jsx(s.Control,{size:"sm",type:E?"text":"password",className:"pe-5",value:x.password,onChange:g=>j({...x,password:g.target.value})}),e.jsx("button",{type:"button",className:"btn btn-link position-absolute top-50 end-0 translate-middle-y text-muted px-3 border-0 py-0",onClick:()=>r(!E),tabIndex:-1,style:{zIndex:10},children:E?e.jsx(xe,{size:16}):e.jsx(ge,{size:16})})]})]}),e.jsxs(s.Group,{className:"mb-2",children:[e.jsx(s.Label,{className:"small mb-0",children:"Rol"}),e.jsxs(s.Select,{size:"sm",value:x.role,onChange:g=>j({...x,role:g.target.value}),children:[e.jsx("option",{value:"USER",children:"Usuario"}),e.jsx("option",{value:"ADMINISTRADOR",children:"Administrador"}),e.jsx("option",{value:"MODERADOR",children:"Moderador"})]})]})]})}),e.jsxs(G.Footer,{children:[e.jsx(N,{variant:"secondary",onClick:()=>v(!1),children:"Cancelar"}),e.jsx(N,{variant:"primary",onClick:S,disabled:m,children:m?e.jsx(P,{size:"sm"}):"Crear"})]})]})]})}const ze=[{key:"config-home",titulo:"Imágenes del Home",componente:e.jsx(ve,{})},{key:"usuarios",titulo:"Usuarios",componente:e.jsx(Ee,{})},{key:"comercios",titulo:"Comercios",componente:e.jsx(pe,{})},{key:"servicios",titulo:"Servicios",componente:e.jsx(ye,{})},{key:"eventos",titulo:"Eventos",componente:e.jsx(fe,{})},{key:"espacios",titulo:"Espacios Públicos",componente:e.jsx(be,{})},{key:"hospedajes",titulo:"Hospedajes",componente:e.jsx(Ce,{})},{key:"gastronomia",titulo:"Gastronomía",componente:e.jsx(Ne,{})},{key:"termas",titulo:"Termas",componente:e.jsx(Se,{})}];function Te(){const[k,T]=o.useState("usuarios");return e.jsxs(he,{fluid:!0,className:"py-3",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"mb-1",children:"Panel de Moderador"}),e.jsx(Y,{bg:"secondary",children:"Gestión de contenido público"})]}),e.jsx(Z,{activeKey:k,onSelect:A=>T(A),children:ze.map(A=>e.jsxs(Z.Item,{eventKey:A.key,children:[e.jsx(Z.Header,{children:A.titulo}),e.jsx(Z.Body,{children:A.componente})]},A.key))})]})}export{Te as default};
